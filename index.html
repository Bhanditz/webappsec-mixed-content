<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Mixed Content</title>
  <link href=../default.css rel=stylesheet type=text/css>
  <style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-unofficial.png") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
</head>
<body class=h-entry>
<div class=head>
  <p data-fill-with=logo></p>
  <h1 class="p-name no-ref" id=title>Mixed Content</h1>
  <h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Editor’s Draft,
    <span class=dt-updated><span class=value-title title=20140526>26 May 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://projects.mikewest.org/webappsec/specs/mixedcontent/>http://projects.mikewest.org/webappsec/specs/mixedcontent/</a><dt>Editor’s Draft:<dd><a href=http://projects.mikewest.org/webappsec/specs/mixedcontent/>http://projects.mikewest.org/webappsec/specs/mixedcontent/</a><dt>Test Suite:<dd>None Yet<dt>Editors:
<dd class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:mkwst@google.com>Mike West</a> (<span class="p-org org">Google Inc.</span>)</dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=https://i.creativecommons.org/p/zero/1.0/80x15.png></a>
To the extent possible under law, the editors have waived all copyright 
and related or neighboring rights to this work. 
In addition, as of 26 May 2014, 
the editors have made this specification available under the
<a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0 rel=license>Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from an existing specification document.  If so, those parts are instead covered by the license of the existing specification document.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<p class=p-summary data-fill-with=abstract>This specification describes how and why user agents disallow rendering and execution of content loaded over unencrypted or unauthenticated connections in the context of an encrypted and authenticated document.</p>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is an unofficial draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc>
	<li><a href=#intro><span class=secno>1</span>Introduction</a>
	<li><a href=#terms><span class=secno>2</span>Key Concepts and Terminology</a>
		<ul class=toc>
		<li><a href=#terms-defined-here><span class=secno>2.1</span>Terms defined by this specfication</a>
		<li><a href=#terms-defined-by-reference><span class=secno>2.2</span>Terms defined by reference</a></ul>
	<li><a href=#categories><span class=secno>3</span>Categories of Content</a>
		<ul class=toc>
		<li><a href=#categories-active><span class=secno>3.1</span>Active Content</a>
		<li><a href=#categories-passive><span class=secno>3.2</span>Passive Content</a>
			<ul class=toc>
			<li><a href=#categories-passive-optionally-blockable><span class=secno>3.2.1</span>         Optionally-blockable Passive Content       </a>
			<li><a href=#categories-passive-blockable><span class=secno>3.2.2</span>Blockable Passive Content</a></ul></ul>
	<li><a href=#requirements><span class=secno>4</span>User Agent Requirements</a>
		<ul class=toc>
		<li><a href=#requirements-fetching><span class=secno>4.1</span>Resource Fetching</a>
		<li><a href=#requirements-ux><span class=secno>4.2</span>UI Requirements</a>
		<li><a href=#requirements-user-controls><span class=secno>4.3</span>User Controls</a></ul>
	<li><a href=#algorithms><span class=secno>5</span>Algorithms</a>
		<ul class=toc>
		<li><a href=#categorize-document><span class=secno>5.1</span>       Is <var>document</var> a secure browsing context?     </a>
		<li><a href=#should-block-fetch><span class=secno>5.2</span>       Should a fetch of <var>url</var> as <var>context</var> for       <var>client</var> be blocked as mixed content?     </a>
		<li><a href=#should-block-response><span class=secno>5.3</span>       Should <var>response</var> for <var>client</var> be blocked as mixed       content?     </a></ul>
	<li><a href=#fetch-integration><span class=secno>6</span>Modifications to Fetch</a>
	<li><a href=#websockets-integration><span class=secno>7</span>Modifications to WebSockets</a>
	<li><a href=#acknowledgements><span class=secno>8</span>Acknowledgements</a>
	<li><a href=#references><span class=secno></span> References</a>
		<ul class=toc>
		<li><a href=#normative><span class=secno></span> Normative References</a>
		<li><a href=#informative><span class=secno></span> Informative References</a></ul>
	<li><a href=#index><span class=secno></span> Index</a>
	<li><a href=#property-index><span class=secno></span> Property index</a>
	<li><a href=#issues-index><span class=secno></span>Issues Index</a></ul></div>






<section>
  <h2 class="heading settled heading" data-level=1 id=intro><span class=secno>1 </span><span class=content>Introduction</span><a class=self-link href=#intro></a></h2>

<p><em>This section is not normative.</em></p>

<p>When a user successfully loads a document from example.com over a secure
  channel (HTTPS, for example), the user agent is able to make three assertions
  critical to the user’s security and privacy:</p>

  <ul>
    <li>
      The user is communicating with a server that is allowed to claim to be
      <code>example.com</code>, and not one of the many, many servers through
      which her request has hopped. The connection can be
      <strong>authenticated</strong>.
    </li>  
    <li>
      The user’s communications with <code>example.com</code> cannot be
      trivially eavesdropped upon by middlemen, because the requests she makes
      and the responses she receives are <strong>encrypted</strong>.
    </li>
    <li>
      The user’s communications with <code>example.com</code> cannot be
      trivially modified by middlemen, the encryption and authentication
      provide a guarantee of <strong>data integrity</strong>.
    </li>
  </ul>

<p>Together, these assertions give the user some assurance that
  <code>example.com</code> is the only entity that can read and respond to her
  requests (caveat: without shocking amounts of work) and that the bits she’s
  receiving are indeed those that <code>example.com</code> actually sent.</p>

<p>The strength of these assertions is substantially weakened, however, when
  the encrypted and authenticated document requests subresources (scripts,
  images, etc) over an insecure channel. Those resource requests result in a
  document whose status is mixed, as insecure requests are wide open for
  man-in-the-middle attacks. This scenario is unfortunately quite common.</p>

<p>This specification details how user agents can mitigate this risk to users'
  security and privacy by limiting a document’s ability to inadvertently
  communicate in the clear. At worst, resource requests for insecure content
  should downgrade any visible security indicators presented to the user (e.g.
  no "green lock"). At best, these requests should be blocked entirely.</p>
</section>


<section>
  <h2 class="heading settled heading" data-level=2 id=terms><span class=secno>2 </span><span class=content>Key Concepts and Terminology</span><a class=self-link href=#terms></a></h2>

  <h3 class="heading settled heading" data-level=2.1 id=terms-defined-here><span class=secno>2.1 </span><span class=content>Terms defined by this specfication</span><a class=self-link href=#terms-defined-here></a></h3>
  <dl>
    <dt>
      <dfn data-dfn-type=dfn data-export="" id=mixed-content title="mixed content|mixed">mixed content<a class=self-link href=#mixed-content></a></dfn>
    </dt>
    <dd>
      A resource is said to be <strong>mixed content</strong> if its origin is
      <a data-link-type=dfn href=#assumed-insecure-origin title=assumed>assumed</a> or <a data-link-type=dfn href=#proven-insecure-origin title=proven>proven</a> to be insecure, <strong>and</strong> the
      <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#browsing-context title="browsing context">browsing context</a> into which it is loaded is a <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure browsing
      context</a>.
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" id=assumed-insecure-origin title="assumed insecure origin|assumed insecure|assumed">
        assumed insecure origin
      <a class=self-link href=#assumed-insecure-origin></a></dfn>
    </dt>
    <dd>
      An <a data-link-type=dfn href=#origin title=origin>origin</a> is said to be <strong>assumed insecure</strong> if the
      user agent can determine that resources loaded from that origin will not
      be <a data-link-type=dfn href=#tls-protected title=tls-protected>TLS-protected</a> before actually requesting the resource. For
      example, origins whose scheme component is "HTTP" or "WS" fall into this
      category.

<p class=note>Note: The mixed content checks will take place <em>after</em> Strict
      Transport Security is applied to resource URLs, which should simplify
      assumptions of insecurity. <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc6797 title=biblio-rfc6797>[RFC6797]</a></p>
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" id=proven-insecure-origin title="proven insecure origin|proven insecure|proven">
        proven insecure origin
      <a class=self-link href=#proven-insecure-origin></a></dfn>
    </dt>
    <dd>
      An origin is said to be <strong>proven insecure</strong> if the user
      agent determines that resources loaded from that origin are not
      <a data-link-type=dfn href=#tls-protected title=tls-protected>TLS-protected</a> only after sending a request out over the network.
      For example, this would include an <a data-link-type=dfn href=#origin title=origin>origin</a> whose scheme component
      is "HTTPS", but whose server presents an invalid certificate, or
      negotiates an ineffective encryption algorithm.
    </dd>
  </dl>

  <h3 class="heading settled heading" data-level=2.2 id=terms-defined-by-reference><span class=secno>2.2 </span><span class=content>Terms defined by reference</span><a class=self-link href=#terms-defined-by-reference></a></h3>
  <dl>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=plugin>plugin<a class=self-link href=#plugin></a></dfn></dt>
    <dd>
      This term is <a data-link-type=dfn href=#plugin title=plugin>defined in the HTML5 specification</a>
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-html5 title=biblio-html5>[HTML5]</a>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=tls-protected>TLS-protected<a class=self-link href=#tls-protected></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=weakly-tls-protected>weakly TLS-protected<a class=self-link href=#weakly-tls-protected></a></dfn></dt>
    <dd>
      These terms are defined in
      <a href=http://www.w3.org/TR/2010/REC-wsc-ui-20100812/#typesoftls>Section
      5.2 of "Web Security Context: User Interface Guidelines"</a>. <a data-biblio-type=normative data-link-type=biblio href=#biblio-wsc-ui title=biblio-wsc-ui>[WSC-UI]</a>.

<p class=issue id=issue-3c75cc41><a class=self-link href=#issue-3c75cc41></a>Are these reasonable definitions that we want to run with?</p>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=origin>origin<a class=self-link href=#origin></a></dfn></dt>
    <dd>
      An origin defines the scope of authority or privilige under which a
      resource operates. It is defined in detail in the Origin specification.
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6454 title=biblio-rfc6454>[RFC6454]</a>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=globally-unique-identifier>globally unique identifier<a class=self-link href=#globally-unique-identifier></a></dfn></dt>
    <dd>
      This term is defined in
      <a href=http://tools.ietf.org/html/rfc6454#section-4>Section 4 of the
      Origin specification</a>. Note that URLs that do not use
      <a href=http://tools.ietf.org/html/rfc3986#section-3.2>hierarchical
      elements</a> as naming authorities (for example: <code>blob:</code>, and
      <code>data:</code>) have origins which are globally unique identifiers.
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6454 title=biblio-rfc6454>[RFC6454]</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-uri title=biblio-uri>[URI]</a>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=fetch>fetch<a class=self-link href=#fetch></a></dfn></dt>
    <dd>
      "fetching" is the process by which a user agent requests resources, and
      delivers responses. It is defined in detail in the Fetch living standard.
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=biblio-fetch>[FETCH]</a>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=request>request<a class=self-link href=#request></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=request-client title="request client|client">request client<a class=self-link href=#request-client></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=request-context title="request context|context">request context<a class=self-link href=#request-context></a></dfn></dt>
    <dd>
      These terms are defined in 
      <a href=http://fetch.spec.whatwg.org/#requests>Section 2.2</a> of the
      Fetch living standard. <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=biblio-fetch>[FETCH]</a>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=response>response<a class=self-link href=#response></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=network-error>network error<a class=self-link href=#network-error></a></dfn></dt>
    <dd> 
      These terms are defined in detail in
      <a href=http://fetch.spec.whatwg.org/#responses>Section 2.3</a> of the
      Fetch living standard. <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=biblio-fetch>[FETCH]</a>
    </dd>
  </dl>
</section>

<section>
  <h2 class="heading settled heading" data-level=3 id=categories><span class=secno>3 </span><span class=content>Categories of Content</span><a class=self-link href=#categories></a></h2>

<p>Categories of content are defined informally directly below. Note that the
  lists in the following three sections attempt to be comprehensive, but the
  platform is huge: in practice, user agents will determine a resource’s
  category based on it’s <a data-link-type=dfn href=#request-context title="request context">request context</a>, which is much simpler to
  exhaustively define.</p>

<p class=note>Note: Fetch defines several <a data-link-type=dfn href=#request-context title="request contexts">request contexts</a> that do not appear in
  the following sections: <code>form</code>, <code>navigate</code>, and
  <code>popup</code>. These <dfn data-dfn-type=dfn data-noexport="" id=navigational-request-contexts>navigational request contexts<a class=self-link href=#navigational-request-contexts></a></dfn> are
  navigations, not content, and will not be blocked as mixed content. User
  agents are free treat one or more of these categories as <a data-link-type=dfn href=#blockable-passive-content title="blockable passive">blockable
  passive</a> content if they choose to do so: there are reasonable arguments
  for restricting mixed form submissions, for example.</p>

  <section>
    <h3 class="heading settled heading" data-level=3.1 id=categories-active><span class=secno>3.1 </span><span class=content>Active Content</span><a class=self-link href=#categories-active></a></h3>

<p><dfn data-dfn-type=dfn data-export="" id=active-content title="active content|active">Active content<a class=self-link href=#active-content></a></dfn> is content
    which can in some way directly manipulate the resource with which a user
    is interacting. JavaScript and CSS are the clearest examples: if an attacker
    can manipulate the script and style a page loads, she can completely control
    the activity on a webpage and exfiltrate data at will. Active content
    include the following resource types:</p>

    <ul>
      <li>
        Scripts (loaded, for example, via <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/scripting-1.html#script title=script>script</a> elements, as
        well as scripts loaded as Workers and SharedWorkers <a data-biblio-type=normative data-link-type=biblio href=#biblio-workers title=biblio-workers>[WORKERS]</a>, or
        ServiceWorkers <a data-biblio-type=normative data-link-type=biblio href=#biblio-serviceworkers title=biblio-serviceworkers>[SERVICEWORKERS]</a>) <a data-biblio-type=normative data-link-type=biblio href=#biblio-ecma-262 title=biblio-ecma-262>[ECMA-262]</a>
      </li>
      <li>Stylesheets <a data-biblio-type=normative data-link-type=biblio href=#biblio-css-2010 title=biblio-css-2010>[CSS-2010]</a></li>
      <li>
        <a data-link-type=dfn href=#plugin title=plugin>Plugin</a> data (loaded, for example, through
        <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/obsolete.html#the-applet-element title=applet>applet</a>, <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-embed-element title=embed>embed</a>, or <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-object-element title=object>object</a>
        elements; or through a <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#plugin-document title="plugin document">plugin document</a> loaded into an
        <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-iframe-element title=iframe>iframe</a> or <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/obsolete.html#frame title=frame>frame</a> element)
      </li>
      <li>SVG Documents <a data-biblio-type=normative data-link-type=biblio href=#biblio-svg2 title=biblio-svg2>[SVG2]</a></li>
      <li>XSL Transformations <a data-biblio-type=normative data-link-type=biblio href=#biblio-xslt title=biblio-xslt>[XSLT]</a></li>
      <li>HTML Imports <a data-biblio-type=normative data-link-type=biblio href=#biblio-html-imports title=biblio-html-imports>[HTML-IMPORTS]</a></li>
      <li>HTML Manifests <a data-biblio-type=normative data-link-type=biblio href=#biblio-manifest title=biblio-manifest>[MANIFEST]</a></li>
      <li>Documents rendered in <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-iframe-element title=iframe>iframe</a> elements</li>
    </ul>

<p>These resource types map to the following Fetch <a data-link-type=dfn href=#request-context title="request contexts">request contexts</a>:
    <code>script</code>, <code>worker</code>, <code>sharedworker</code>,
    <code>serviceworker</code>, <code>style</code>, <code>object</code>, and
    <code>child</code>. These contexts are <dfn data-dfn-type=dfn data-noexport="" id=active-request-contexts>active request contexts<a class=self-link href=#active-request-contexts></a></dfn>.</p>

<p>The contents of an <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-iframe-element title=iframe>iframe</a> are considered active content
    because same-origin frames can reach up into their <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#parent-browsing-context title="parent browsing context">parent browsing
    context</a> via JavaScript, and even cross-origin frames can initiate
    top-level navigations. User agents MAY decide to treat cross-origin
    frames as <a data-link-type=dfn href=#passive-content title=passive>passive</a> content if that capability is removed by applying
    a appropriate <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#sandboxing-flag-set title="sandboxing flag set">sandboxing flag set</a> (e.g. one which does not include
    the <a data-link-type=element-attr href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#attr-iframe-sandbox-allow-top-navigation title=allow-top-navigation>allow-top-navigation</a> flag).</p>

<p class=note>Note: <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-iframe-element title=iframe>iframe</a> elements, as currently implemented in user
    agents do come with risks beyond those mentioned above. For example,
    <a href=http://lcamtuf.blogspot.de/2012/05/yes-you-can-have-fun-with-downloads.html>a
    downloaded file’s origin is often difficult to pinpoint</a>, HTTP
    authentication prompts are sometimes allowed (after a HTTP 401 response,
    for instance), and modal prompts like <code>window.prompt()</code> can
    confuse users. These risks exist even with secure iframes, but attackers
    can more easily inject malicious code into innocent but insecure iframes.</p>
  </section>

  <section>
    <h3 class="heading settled heading" data-level=3.2 id=categories-passive><span class=secno>3.2 </span><span class=content>Passive Content</span><a class=self-link href=#categories-passive></a></h3>

<p><dfn data-dfn-type=dfn data-export="" id=passive-content title="passive content|passive">Passive content<a class=self-link href=#passive-content></a></dfn> includes
    resources which cannot directly interact with or modify other resources on
    a page: images, fonts, audio, and video for example. The risk of rendering a
    manipulated passive resource is significantly lower than executing an
    <a data-link-type=dfn href=#active-content title=active>active</a> resource; passive content can confuse or deceive users, but
    cannot directly manipulate other resources on a page or exfiltrate data.</p>

<p><a data-link-type=dfn href=#active-content title="active content">Active content</a> is clearly dangerous in a <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a> context, and
    must be blocked from executing in those contexts to protect both users and
    site authors, regardless of the risk of breaking insecurely composed
    websites. Passive <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a> content is less directly dangerous to
    users: if an attacker manipulates an image resource, the worst case is that
    the attacker-controlled image is displayed to the user rather than the image
    a site’s author intended.</p>

<p>In a perfect world, user agents would be required to block <em>all</em>
    types of <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a>. Unfortunately, there exists a massive amount
    of passive <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a> on the Internet today:
    <a href=http://www.securitee.org/files/mixedinc_isc2013.pdf>according to a
    survey in 2013</a> blocking passive mixed content would break around ~43% of
    secure websites in one way or another. Draconian blocking policies applied to
    passive mixed content are (for the moment) infeasible. User agents must be
    more nuanced in their restrictions.</p>

<p>With that in mind, we’ll split passive content into two categories:
    resources user agents can safely block without breaking the web, and
    resources whose usage in <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a> contexts is simply too high to block
    by default.</p>

<p>Future versions of this specification will update these subcategories with
    the intent of moving towards a world where all <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a> content is
    blocked; that is the end goal, but this is the best we can do for now.</p>

    <section>
      <h4 class="heading settled heading" data-level=3.2.1 id=categories-passive-optionally-blockable><span class=secno>3.2.1 </span><span class=content>
        Optionally-blockable Passive Content
      </span><a class=self-link href=#categories-passive-optionally-blockable></a></h4>

<p>Passive content is
      <dfn data-dfn-type=dfn data-export="" id=optionally-blockable-passive-content title="optionally blockable passive content|optionally blockable passive|optionally blockable">
      optionally blockable<a class=self-link href=#optionally-blockable-passive-content></a></dfn> when the risk of allowing its usage in a <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a>
      context is outweighed by the risk of breaking significant portions of the
      web. This may be because usage of these resource types in <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a>
      contexts is sufficiently high, or because the feature is very clearly
      low-risk in and of itself.</p>

<p>This category includes:</p>

      <ul>
        <li>
          Images loaded via <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-img-element title=img>img</a> or <code>picture</code>

<p class=note>Note: This includes SVG documents loaded as images.</p>
        </li>
        <li>
          Video loaded via <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#video title=video>video</a> and <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-source-element title=source>source</a>
          elements
        </li>
        <li>
          Audio loaded via <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#audio title=audio>audio</a> and <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-source-element title=source>source</a>
          elements
        </li>
        <li>
          Subtitles and captions loaded via <a data-link-type=element href=http://www.w3.org/html/wg/drafts/html/CR/embedded-content-0.html#the-track-element title=track>track</a> elements
        </li>
        <li>
          Beacon <a data-biblio-type=normative data-link-type=biblio href=#biblio-beacon title=biblio-beacon>[BEACON]</a> and
          <a href=http://www.whatwg.org/specs/web-apps/current-work/multipage/links.html#hyperlink-auditing>hyperlink auditing pings</a>
        </li>
      </ul>

<p>These resource types map to the following Fetch <a data-link-type=dfn href=#request-context title="request contexts">request contexts</a>:
      <code>image</code>, <code>media</code>, and <code>ping</code>.
      These contexts are <dfn data-dfn-type=dfn data-noexport="" id=optionally-blockable-passive-request-contexts>optionally blockable passive request contexts<a class=self-link href=#optionally-blockable-passive-request-contexts></a></dfn>.</p>

<p class=note>Note: The fact that these resource types are on the "optionally blockable"
      list does not mean that they are <em>safe</em>, simply that they’re less
      catastrophically dangerous as the resource types on the "active" list.
      For example, images and icons are often the central UI elements in an
      application’s interface. If an attacker reversed the "Delete email"
      and "Reply" icons, there would be real impact on users.</p>
    </section>

    <section>
      <h4 class="heading settled heading" data-level=3.2.2 id=categories-passive-blockable><span class=secno>3.2.2 </span><span class=content>Blockable Passive Content</span><a class=self-link href=#categories-passive-blockable></a></h4>

<p>Passive content is
      <dfn data-dfn-type=dfn data-export="" id=blockable-passive-content title="blockable passive content|blockable passive|blockable">
      blockable<a class=self-link href=#blockable-passive-content></a></dfn> when the risk of allowing its usage in a <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a>
      context outwighs the risk of temporary inconvinience for those site
      authors delivering insecurely composed pages. This may be because usage
      of these features in <a data-link-type=dfn href=#mixed-content title=mixed>mixed</a> contexts is sufficiently low, or
      because the content is close to the boundry between <a data-link-type=dfn href=#active-content title=active>active</a> and
      <a data-link-type=dfn href=#passive-content title=passive>passive</a>.</p>

<p>This category includes all content that is not <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable">optionally blockable</a>
      or <a data-link-type=dfn href=#active-content title=active>active</a>. For example:</p>

      <ul>
        <li>
          Data (loaded, for example, via XMLHttpRequest <a data-biblio-type=normative data-link-type=biblio href=#biblio-xmlhttprequest title=biblio-xmlhttprequest>[XMLHTTPREQUEST]</a>,
          EventSource <a data-biblio-type=normative data-link-type=biblio href=#biblio-eventsource title=biblio-eventsource>[EVENTSOURCE]</a>, or WebSockets <a data-biblio-type=normative data-link-type=biblio href=#biblio-websockets title=biblio-websockets>[WEBSOCKETS]</a>)
        </li>
        <li>Web Fonts <a data-biblio-type=normative data-link-type=biblio href=#biblio-css3-webfonts title=biblio-css3-webfonts>[CSS3-WEBFONTS]</a></li>
        <li>Custom Filters <a data-biblio-type=normative data-link-type=biblio href=#biblio-filter-effects title=biblio-filter-effects>[FILTER-EFFECTS]</a></li>
        <li>
          Resources which are not rendered directly in the browser, but
          downloaded to a user’s storage device (either as a result of a
          <a data-link-type=element-attr href=http://www.w3.org/html/wg/drafts/html/CR/links.html#attr-hyperlink-download title=download>download</a> attribute, or
          <code>Content-Disposition</code> headers)
        </li>
      </ul>

<p class=note>Note: In particular, this category includes data loaded via
      <code>XMLHttpRequest</code>, <code>EventSource</code>, or
      <code>WebSockets</code>. While these communication mechanism are
      <em>technically</em> passive, developers very often use them to gather
      data that effects program control flow (consider a missile silo UI
      that grabs JSON to determine whether to reveal the Big Red Launch Button:
      <code>{ showLaunchButton: false }</code>).</p>

<p>These resource types map to the following Fetch <a data-link-type=dfn href=#request-context title="request contexts">request contexts</a>:
      <code>connect</code>, <code>download</code>, and <code>font</code>.
      These contexts are <dfn data-dfn-type=dfn data-noexport="" id=blockable-passive-request-contexts>blockable passive request contexts<a class=self-link href=#blockable-passive-request-contexts></a></dfn>.</p>
    </section>
  </section>
</section>
<section>
  <h2 class="heading settled heading" data-level=4 id=requirements><span class=secno>4 </span><span class=content>User Agent Requirements</span><a class=self-link href=#requirements></a></h2>

  <section>
    <h3 class="heading settled heading" data-level=4.1 id=requirements-fetching><span class=secno>4.1 </span><span class=content>Resource Fetching</span><a class=self-link href=#requirements-fetching></a></h3>

<p>If a <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> is a <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure browsing context</a>, then
    user agents MUST adhere to the following requirements when <a data-link-type=dfn href=#fetch title=fetching>fetching</a>
    resources in response to its requests:</p>

    <ol>
      <li>
        <a data-link-type=dfn href=#request title=requests>Requests</a> for <a data-link-type=dfn href=#active-content title=active>active</a> resources and <a data-link-type=dfn href=#blockable-passive-content title="blockable passive">blockable passive</a>
        resources from an <a data-link-type=dfn href=#assumed-insecure-origin title="assumed insecure origin">assumed insecure origin</a> MUST not generate
        network traffic, and MUST instead return a synthetically generated
        <a data-link-type=dfn href=#network-error title="network error">network error</a> response.
      </li>

      <li>
        <a data-link-type=dfn href=#request title=requests>Requests</a> for <a data-link-type=dfn href=#active-content title=active>active</a> resources and <a data-link-type=dfn href=#blockable-passive-content title="blockable passive">blockable passive</a>
        resources from an <a data-link-type=dfn href=#proven-insecure-origin title="proven insecure origin">proven insecure origin</a> MUST not be delivered to
        the requesting <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a>, but instead MUST return a
        synthetically generated <a data-link-type=dfn href=#network-error title="network error">network error</a> response.
      </li>

      <li>
        <a data-link-type=dfn href=#request title=requests>Requests</a> for <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable passive">optionally blockable passive</a> resources which
        are <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a> MAY be treated as <a data-link-type=dfn href=#active-content title=active>active</a> (and therefore
        blocked entirely or returned as a <a data-link-type=dfn href=#network-error title="network error">network error</a> as described
        above).

<p class=note>Note: For instance, a user agent could interpret the presence of a
        <code>Strict-Transport-Security</code> header field as forcing all
        content into the <a data-link-type=dfn href=#active-content title=active>active</a> category. <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc6797 title=biblio-rfc6797>[RFC6797]</a></p>
      </li>
    </ol>

<p>The <a data-section="" href=#fetch-integration>Modifications to Fetch</a> and
    <a data-section="" href=#algorithms>Algorithms</a> sections detail how these fetching
    requirements could be implemented.</p>
  </section>

  <section>
    <h3 class="heading settled heading" data-level=4.2 id=requirements-ux><span class=secno>4.2 </span><span class=content>UI Requirements</span><a class=self-link href=#requirements-ux></a></h3>

<p>If a <a data-link-type=dfn href=#request title=request>request</a> for <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable passive">optionally blockable passive</a> resources
    which are <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a> is <strong>not</strong> treated as <a data-link-type=dfn href=#active-content title="active content">active
    content</a> (per requirement #3 above), then the user agent MUST adhere to
    the following requirements:</p>

    <ul>
      <li>
        The user agent MUST NOT provide the user with a visible indication that
        the <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> which loaded that resource is secure
        (for instance, via a green lock icon). The user agent SHOULD instead
        display a visible indication that <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a> is present.

<p>This requirement explicitly includes any visible indication of the
        <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a>’s
        <a href=https://cabforum.org/about-ev-ssl/>EV status</a>.</p>
      </li>
    </ul>
  </section>

  <section>
    <h3 class="heading settled heading" data-level=4.3 id=requirements-user-controls><span class=secno>4.3 </span><span class=content>User Controls</span><a class=self-link href=#requirements-user-controls></a></h3>

<p>User agents MAY offer users the ability to directly decide whether or not to
    treat <strong>all</strong> <a data-link-type=dfn href=#mixed-content title="mixed content">mixed content</a> as <a data-link-type=dfn href=#active-content title=active>active</a> (meaning
    that even <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable passive content">optionally blockable passive content</a> would be blocked in a
    mixed context). </p>

<p class=note>Note: It is <em>strongly recommended</em> that users take advantage of such
    an option if provided.</p>

<p>User agents MAY offer users the ability to override its decision to block
    <a data-link-type=dfn href=#blockable-passive-content title="blockable passive">blockable passive</a> mixed content on a particular page.</p>

<p>User agents MAY also offer users the ability to override its decision to
    block <a data-link-type=dfn href=#active-content title=active>active</a> mixed content on a page.    </p>

<p class=note>Note: Practically, user agents probably can’t get away with not offering
    such a back door. That said, allowing active mixed content is in
    particular a very dangerous option, and user agents
    <a href=http://tools.ietf.org/html/rfc6919#section-3>REALLY SHOULD
    NOT</a> present such a choice to users without careful consideration and
    communication of the risk involved.</p>
  </section>
</section>

<section>
  <h2 class="heading settled heading" data-level=5 id=algorithms><span class=secno>5 </span><span class=content>Algorithms</span><a class=self-link href=#algorithms></a></h2>

  <section>
    <h3 class="heading settled heading" data-level=5.1 id=categorize-document><span class=secno>5.1 </span><span class=content>
      Is <var>document</var> a secure browsing context?
    </span><a class=self-link href=#categorize-document></a></h3>

<p>User agents MUST ensure that nested browsing contexts are checked against
    the top-level parent context, as that is the context which controls the
    user’s expectations regarding the security status of the resource she’s
    loaded. The following nested-framing scenarios are interesting: </p>

    <ol>
      <li><code>http://a.com</code> frames <code>https://b.com</code>, which
      loads <code>http://evil.com</code>. In this case, the insecure request
      to <code>evil.com</code> MUST be blocked, as <code>b.com</code> was
      loaded over a secure connection.</li>

      <li><code>https://a.com</code> frames <code>http://b.com</code>, which
      loads <code>http://evil.com</code>. In this case, the insecure request
      to <code>evil.com</code> MUST not be allowed, as <code>a.com</code> was
      loaded in a secure context (and, hopefully <em>cannot</em> happen, as
      the <code>b.com</code> frame MUST not be loaded over an insecure channel
      in the first place).</li>
    </ol>

<p>Given a <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> <var>document</var>, the user agent can
    determine if <var>document</var> is a <dfn data-dfn-type=dfn data-noexport="" id=secure-browsing-context>secure browsing context<a class=self-link href=#secure-browsing-context></a></dfn>
    via the following algorithm, which returns <strong>true</strong> if the
    <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> is a secure browsing context, and
    <strong>false</strong> otherwise. </p>

    <ol>
      <li>
        If <var>document</var> is <a data-link-type=dfn href=#tls-protected title=tls-protected>TLS-protected</a>, return
        <strong>true</strong>.
      </li>
      <li>
        If the scheme component of <var>document</var>’s URL is of a type
        designating a <a data-link-type=dfn href=#globally-unique-identifier title="globally unique identifier">globally unique identifier</a> (such as "blob" or
        "data"), return <strong>true</strong>.
      </li>
      <li>
        If <var>document</var> is a <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#nested-browsing-context title="nested browsing context">nested browsing context</a>:

        <ol>
          <li>
            If the <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#top-level-browsing-context title="top-level browsing context">top-level browsing context</a> is a <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure
            browsing context</a>, return <strong>true</strong>.
          </li>
        </ol>
      </li>

      <li>Return <strong>false</strong>.</li>
    </ol>
  </section>

  <section>
    <h3 class="heading settled heading" data-level=5.2 id=should-block-fetch><span class=secno>5.2 </span><span class=content>
      Should a fetch of <var>url</var> as <var>context</var> for
      <var>client</var> be blocked as mixed content?
    </span><a class=self-link href=#should-block-fetch></a></h3>

<p>User agents should entirely block requests to <a data-link-type=dfn href=#active-content title=active>active</a> mixed content;
    the Fetch specification will hook into this algorithm to determine whether a
    request should be entirely blocked (e.g. because the request would be used
    as <a data-link-type=dfn href=#active-content title="active content">active content</a>, and we can <em>assume</em> that it won’t be
    loaded over a secure connection).</p>

<p>Given a request’s URL <var>url</var>, <a data-link-type=dfn href=#request-context title="request context">request context</a>
    <var>context</var>, and <a data-link-type=dfn href=#request-client title="request client">request client</a> <var>client</var>, a user
    agent can determine whether the request should proceed or not via the
    following algorithm</p>

    <ol>
      <li>
        Let <var>document</var> be the <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> with which
        <var>client</var> is associated.
      </li>
      <li>
        If <var>document</var> is not a <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure browsing context</a>, return
        <strong>allowed</strong>.
      </li>
      <li>
        If the scheme component of <var>url</var> is "HTTPS", return
        <strong>allowed</strong>.
      </li>
      <li>
        If the scheme component of <var>url</var> is of a type designating a
        <a data-link-type=dfn href=#globally-unique-identifier title="globally unique identifier">globally unique identifier</a>, (such as "blob" or "data") then
        return <strong>allowed</strong>.
      </li>
      <li>
        If <var>context</var> is an <a data-link-type=dfn href=#active-request-contexts title="active request context">active request context</a> or
        <a data-link-type=dfn href=#blockable-passive-request-contexts title="blockable passive request context">blockable passive request context</a>, return
        <strong>blocked</strong>.
      </li>
      <li>
        If the user agent is configured to block <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable passive">optionally blockable
        passive</a> mixed content, return <strong>blocked</strong>.
      </li>
      <li>
        Return <strong>allowed</strong>.
      </li>
    </ol>

<p class=issue id=issue-9a86d6f9><a class=self-link href=#issue-9a86d6f9></a>This doesn’t currently process resources loaded via
    <code>&lt;link rel="subresource" ...&gt;</code> or
    <code>Link: ...; prefetch</code>. Perhaps we should?</p>
  </section>

  <section>
    <h3 class="heading settled heading" data-level=5.3 id=should-block-response><span class=secno>5.3 </span><span class=content>
      Should <var>response</var> for <var>client</var> be blocked as mixed
      content?
    </span><a class=self-link href=#should-block-response></a></h3>

<p><a href=#should-block-fetch>If a request proceeds</a>, we still might want
    to block the response based on the state of the connection that generated
    the response (e.g. because the response would be used as <a data-link-type=dfn href=#active-content title="active content">active
    content</a>, but the server is <a data-link-type=dfn href=#proven-insecure-origin title="proven insecure">proven insecure</a>).</p>

<p>Given a <a data-link-type=dfn href=#response title=response>response</a> <var>response</var>, and <a data-link-type=dfn href=#request-client title="request client">request client</a>
    <var>client</var>, the user agent can determine what response should be
    returned via the following algorithm:</p>

    <ol>
      <li>
        Let <var>document</var> be the <a class=idl-code data-link-type=interface href=http://www.w3.org/html/wg/drafts/html/CR/infrastructure.html#dom-document title=document>Document</a> with which
        <var>client</var> is associated.
      </li>
      <li>
        If <var>document</var> is not a <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure browsing context</a>, return
        <strong>allowed</strong>.
      </li>
      <li>
        Let <var>context</var> be the <a data-link-type=dfn href=#request-context title="request context">request context</a> of the request
        which generated <var>response</var>.
      </li>
      <li>
        If <var>context</var> is an <a data-link-type=dfn href=#active-request-contexts title="active request context">active request context</a> or
        <a data-link-type=dfn href=#blockable-passive-request-contexts title="blockable passive request context">blockable passive request context</a>, or the user agent is
        configured to block <a data-link-type=dfn href=#optionally-blockable-passive-content title="optionally blockable passive">optionally blockable passive</a> mixed content:

        <ol>
          <li>
            If the response is not <a data-link-type=dfn href=#tls-protected title=tls-protected>TLS-protected</a>, return
            <strong>blocked</strong>.

<p class=issue id=issue-7f528e67><a class=self-link href=#issue-7f528e67></a>This is intended to cover cases in which a ServiceWorker
            responds to a request with an insecure resource. It’s not clear
            that this is the correct place to do that, however, as the
            integration with Fetch isn’t fully specified. It’s also not really
            clear what "insecure" should mean in a ServiceWorker context. We
            accept 'blob:' resources, for instance: should we accept responses
            synthesized by the service worker?</p>
          </li>
          <li>
            If the response is only <a data-link-type=dfn href=#weakly-tls-protected title="weakly tls-protected">weakly TLS-protected</a>, return
            <strong>blocked</strong>.

<p class=note>Note: This covers cases in which the TLS handshake for a resource
            request succeeded, but failed to agree upon a configuration that
            the user agent considers secure. For instance, the server might
            have negotiated down to an insecure protocol like SSL 2.0, chosen a
            weak cipher suite like <code>SSL_RSA_WITH_NULL_MD5</code>,
            or presented a weak certificate (for instance, one which doesn’t
            meet the
            <a href=https://cabforum.org/baseline-requirements-documents/>CA/B
            forum’s baseline requirements</a>).</p>
          </li>
        </ol>
      </li>
      <li>Return <strong>allowed</strong>.</li>
    </ol>

<p class=issue id=issue-f2454bf1><a class=self-link href=#issue-f2454bf1></a>Should we discuss mixed-pinning? (See
    <a href="https://code.google.com/p/chromium/issues/detail?id=259961">crbug.com/259961</a>
    for context).</p>
  </section>
</section>

<section>
  <h2 class="heading settled heading" data-level=6 id=fetch-integration><span class=secno>6 </span><span class=content>Modifications to Fetch</span><a class=self-link href=#fetch-integration></a></h2>

<p class=issue id=issue-51f86577><a class=self-link href=#issue-51f86577></a>Replace this section with some pointers to Fetch once we can get Fetch
  updated accordingly.</p>

<p>When fetching resources, the mixed content checks described in the algorithms
  above should be inserted at the top of the Fetch algorithm to block network
  traffic to <a data-link-type=dfn href=#assumed-insecure-origin title="assumed insecure origins">assumed insecure origins</a>, and at the bottom of the
  algorithm, to block responses from <a data-link-type=dfn href=#proven-insecure-origin title="proven insecure origins">proven insecure origins</a>.</p>

<p>The Fetch algorithm MUST be updated as follows: <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=biblio-fetch>[FETCH]</a></p>

  <ul>
    <li>
      After <a href=http://fetch.spec.whatwg.org/#concept-fetch>step 1 of the
      current Fetch algorithm</a>, perform the following steps:

      <ol>
        <li>
          Let <var>context</var> be <var>request</var>’s <code>context</code>.
        </li>
        <li>
          Let <var>client</var> be <var>request</var>’s <code>client</code>.
        </li>
        <li>
          If the <a href=#should-block-fetch>Should a Fetch of <var>url</var>
          as <var>context</var> for <var>client</var> be blocked as mixed
          content?</a> algorithm returns <strong><code>blocked</code></strong>:

          <ol>
            <li>Set <var>response</var> to a <a data-link-type=dfn href=#network-error title="network error">network error</a>.</li>
            <li>Skip to step 7 of the current Fetch algorithm.</li>
          </ol>
        </li>
      </ol>

<p class=note>Note: Hooking into Fetch here ensures that we catch not only the initial
      request, but all redirects as well. That is certainly the intent.</p>
    </li>
    <li>
      After <a href=http://fetch.spec.whatwg.org/#concept-fetch>step 9 of the
      current Fetch algorithm</a>, perform the following steps:

      <ol>
        <li>
          Let <var>client</var> be <var>request</var>’s <code>client</code>.
        </li>
        <li>
          If the <a href=#should-block-response>Should <var>response</var>
          for <var>client</var> be blocked as mixed content?</a> algorithm
          returns <strong><code>blocked</code></strong>:

          <ol>
            <li>Set <var>response</var> to a <a data-link-type=dfn href=#network-error title="network error">network error</a>.</li>
          </ol>

        </li>
      </ol>

<p class=note>Note: This hook is necessary to detect resources modified or
      synthesized by a ServiceWorker, as well as to determine whether a
      resource is <a data-link-type=dfn href=#proven-insecure-origin title="proven insecure">proven insecure</a> See steps 4.1 and 4.2 of the
      <a data-section="" href=#should-block-response>
      Should response for client be blocked as mixed
      content?
    </a> algorithm for detail.</p>
    </li>
  </ul>
</section>

<section>
  <h2 class="heading settled heading" data-level=7 id=websockets-integration><span class=secno>7 </span><span class=content>Modifications to WebSockets</span><a class=self-link href=#websockets-integration></a></h2>

<p>WebSocket connections don’t go through the Fetch algorithm, they’re defined
  defined in the
  <a href=http://tools.ietf.org/html/rfc6455#section-4.1>Establish a WebSocket
  Connection</a> algorithm <a data-biblio-type=normative data-link-type=biblio href=#biblio-wsp title=biblio-wsp>[WSP]</a>, and in the 'WebSocket()' constructor
  algorithm. Those algorithm MUST be modified as follows:</p>

  <ul>
    <li>
      Replace
      <a href=http://www.w3.org/TR/2012/CR-websockets-20120920/#the-websocket-interface>
        Step 2 of the <code>WebSocket()</code> constructor algorithm
      </a> with the following step:

      <ol>
        <li>
          If <var>secure</var> is <strong>false</strong>, but the <a data-link-type=dfn href=http://www.w3.org/html/wg/drafts/html/CR/browsers.html#browsing-context title="browsing context">browsing
          context</a> which the <var>entry script</var> is associated with is a
          <a data-link-type=dfn href=#secure-browsing-context title="secure browsing context">secure browsing context</a>, then throw a
          <code>SecurityError</code> exception.
        </li>
      </ol>
    </li>
    <li>
      After <a href=http://tools.ietf.org/html/rfc6455#section-4.1>step 5 of
      the current Establish a WebSocket Connection algorithm</a>, perform the
      following step:

      <ol>
        <li>
          If secure is <strong>true</strong>, and the TLS handshake performed
          in step 5 results in a <a data-link-type=dfn href=#weakly-tls-protected title="weakly tls-protected">weakly TLS-protected</a> connection, then
          the client MUST
          <a href=http://tools.ietf.org/html/rfc6455#section-7.1.7>Fail the
          WebSocket Connection</a> and abort the connection.
        </li>
      </ol>
    </li>
  </ul>
</section>

<section>
  <h2 class="heading settled heading" data-level=8 id=acknowledgements><span class=secno>8 </span><span class=content>Acknowledgements</span><a class=self-link href=#acknowledgements></a></h2>

<p>This specification does not invent new behaviors, attempting instead to
  document and rationalize existing behaviors. Everything covered here
  has appeared in one or more user agents over the years: Internet Explorer led
  the way, blocking mixed active content since at least version 6.</p>
</section>

<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl>
<dt id=biblio-beacon title=BEACON><a class=self-link href=#biblio-beacon></a>[BEACON]<dd>Jatinder Mann; Alois Reitbauer. <a href=http://www.w3.org/TR/beacon/>Beacon</a>. WD. URL: <a href=http://www.w3.org/TR/beacon/>http://www.w3.org/TR/beacon/</a></dd>
<dt id=biblio-css-2010 title=CSS-2010><a class=self-link href=#biblio-css-2010></a>[CSS-2010]<dd>Elika J. Etemad. <a href=http://www.w3.org/TR/2011/NOTE-css-2010-20110512/>Cascading Style Sheets (CSS) Snapshot 2010</a>. 12 May 2011. W3C Working Group Note. URL: <a href=http://www.w3.org/TR/2011/NOTE-css-2010-20110512/>http://www.w3.org/TR/2011/NOTE-css-2010-20110512/</a></dd>
<dt id=biblio-css3-webfonts title=CSS3-WEBFONTS><a class=self-link href=#biblio-css3-webfonts></a>[CSS3-WEBFONTS]<dd>Michel Suignard; Chris Lilley. <a href=http://www.w3.org/TR/2002/WD-css3-webfonts-20020802>CSS3 module: Web Fonts</a>. 2 August 2002. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2002/WD-css3-webfonts-20020802>http://www.w3.org/TR/2002/WD-css3-webfonts-20020802</a></dd>
<dt id=biblio-ecma-262 title=ECMA-262><a class=self-link href=#biblio-ecma-262></a>[ECMA-262]<dd>???. <a href=http://www.ecma-international.org/publications/standards/Ecma-262.htm>ECMAScript Language Specification, Third Edition</a>. December 1999. URL: <a href=http://www.ecma-international.org/publications/standards/Ecma-262.htm>http://www.ecma-international.org/publications/standards/Ecma-262.htm</a></dd>
<dt id=biblio-eventsource title=EVENTSOURCE><a class=self-link href=#biblio-eventsource></a>[EVENTSOURCE]<dd>Ian Hickson. <a href=http://www.w3.org/TR/2012/CR-eventsource-20121211/>Server-Sent Events</a>. 11 December 2012. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/CR-eventsource-20121211/>http://www.w3.org/TR/2012/CR-eventsource-20121211/</a></dd>
<dt id=biblio-fetch title=FETCH><a class=self-link href=#biblio-fetch></a>[FETCH]<dd>Anne van Kesteren. <a href=http://fetch.spec.whatwg.org/>Fetch</a>. Living Standard. URL: <a href=http://fetch.spec.whatwg.org/>http://fetch.spec.whatwg.org/</a></dd>
<dt id=biblio-filter-effects title=FILTER-EFFECTS><a class=self-link href=#biblio-filter-effects></a>[FILTER-EFFECTS]<dd>Dean Jackson; Erik Dahlström; Dirk Schulze. <a href=http://www.w3.org/TR/2013/WD-filter-effects-20130523/>Filter Effects 1.0</a>. 23 May 2013. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/WD-filter-effects-20130523/>http://www.w3.org/TR/2013/WD-filter-effects-20130523/</a></dd>
<dt id=biblio-html-imports title=HTML-IMPORTS><a class=self-link href=#biblio-html-imports></a>[HTML-IMPORTS]<dd>Dmitri Glazkov; Hajime Morrita. <a href=http://www.w3.org/TR/html-imports/>HTML Imports</a>. WD. URL: <a href=http://www.w3.org/TR/html-imports/>http://www.w3.org/TR/html-imports/</a></dd>
<dt id=biblio-html5 title=HTML5><a class=self-link href=#biblio-html5></a>[HTML5]<dd>Robin Berjon; et al. <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>HTML5</a>. 6 August 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/CR-html5-20130806/>http://www.w3.org/TR/2013/CR-html5-20130806/</a></dd>
<dt id=biblio-manifest title=MANIFEST><a class=self-link href=#biblio-manifest></a>[MANIFEST]<dd>Marcos Caceres; Anssi Kostiainen; Kenneth Rohde Christiansen. <a href=http://w3c.github.io/manifest/>Manifest for web application</a>. WD. URL: <a href=http://w3c.github.io/manifest/>http://w3c.github.io/manifest/</a></dd>
<dt id=biblio-rfc6454 title=RFC6454><a class=self-link href=#biblio-rfc6454></a>[RFC6454]<dd>Adam Barth. <a href=http://www.ietf.org/rfc/rfc6454.txt>The Web Origin Concept</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6454.txt>http://www.ietf.org/rfc/rfc6454.txt</a></dd>
<dt id=biblio-serviceworkers title=SERVICEWORKERS><a class=self-link href=#biblio-serviceworkers></a>[SERVICEWORKERS]<dd>Alex Russell; Jungkee Song. <a href=http://www.w3.org/TR/service-workers/>Service Workers</a>. WD. URL: <a href=http://www.w3.org/TR/service-workers/>http://www.w3.org/TR/service-workers/</a></dd>
<dt id=biblio-svg2 title=SVG2><a class=self-link href=#biblio-svg2></a>[SVG2]<dd>Nikos Andronikos; et al. <a href=http://www.w3.org/TR/2013/WD-SVG2-20130618/>Scalable Vector Graphics (SVG) 2</a>. 18 June 2013. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/WD-SVG2-20130618/>http://www.w3.org/TR/2013/WD-SVG2-20130618/</a></dd>
<dt id=biblio-uri title=URI><a class=self-link href=#biblio-uri></a>[URI]<dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href=http://www.ietf.org/rfc/rfc3986.txt>Uniform Resource Identifiers (URI): generic syntax</a>. January 2005. URL: <a href=http://www.ietf.org/rfc/rfc3986.txt>http://www.ietf.org/rfc/rfc3986.txt</a></dd>
<dt id=biblio-websockets title=WEBSOCKETS><a class=self-link href=#biblio-websockets></a>[WEBSOCKETS]<dd>Ian Hickson. <a href=http://www.w3.org/TR/2012/CR-websockets-20120920/>The WebSocket API</a>. 20 September 2012. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/CR-websockets-20120920/>http://www.w3.org/TR/2012/CR-websockets-20120920/</a></dd>
<dt id=biblio-workers title=WORKERS><a class=self-link href=#biblio-workers></a>[WORKERS]<dd>Ian Hickson. <a href=http://www.w3.org/TR/2012/CR-workers-20120501/>Web Workers</a>. 1 May 2012. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/CR-workers-20120501/>http://www.w3.org/TR/2012/CR-workers-20120501/</a></dd>
<dt id=biblio-wsc-ui title=WSC-UI><a class=self-link href=#biblio-wsc-ui></a>[WSC-UI]<dd>Thomas Roessler; Anil Saldhana. <a href=http://www.w3.org/TR/2010/REC-wsc-ui-20100812/>Web Security Context: User Interface Guidelines</a>. 12 August 2010. W3C Recommendation. URL: <a href=http://www.w3.org/TR/2010/REC-wsc-ui-20100812/>http://www.w3.org/TR/2010/REC-wsc-ui-20100812/</a></dd>
<dt id=biblio-wsp title=WSP><a class=self-link href=#biblio-wsp></a>[WSP]<dd>Ian Fette; Alexey Melnikov. <a href=http://tools.ietf.org/html/rfc6455>The WebSocket Protocol</a>. RFC. URL: <a href=http://tools.ietf.org/html/rfc6455>http://tools.ietf.org/html/rfc6455</a></dd>
<dt id=biblio-xmlhttprequest title=XMLHTTPREQUEST><a class=self-link href=#biblio-xmlhttprequest></a>[XMLHTTPREQUEST]<dd>Julian Aubourg; 송정기 (Jungkee Song); Hallvord R. M. Steen. <a href=http://www.w3.org/TR/2012/WD-XMLHttpRequest-20121206/>XMLHttpRequest</a>. 6 December 2012. W3C Working Draft. (Work in progress.) URL: <a href=http://www.w3.org/TR/2012/WD-XMLHttpRequest-20121206/>http://www.w3.org/TR/2012/WD-XMLHttpRequest-20121206/</a></dd>
<dt id=biblio-xslt title=XSLT><a class=self-link href=#biblio-xslt></a>[XSLT]<dd>James Clark. <a href=http://www.w3.org/TR/1999/REC-xslt-19991116>XSL Transformations (XSLT) Version 1.0</a>. 16 November 1999. W3C Recommendation. URL: <a href=http://www.w3.org/TR/1999/REC-xslt-19991116>http://www.w3.org/TR/1999/REC-xslt-19991116</a></dd>
</dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl>
<dt id=biblio-rfc6797 title=RFC6797><a class=self-link href=#biblio-rfc6797></a>[RFC6797]<dd>Jeff Hodges; Collin Jackson; Adam Barth. <a href=http://www.ietf.org/rfc/rfc6797.txt>HTTP Strict Transport Security (HSTS)</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6797.txt>http://www.ietf.org/rfc/rfc6797.txt</a></dd>
</dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>active, <a href=#active-content title="section 3.1">3.1</a>
<li>active content, <a href=#active-content title="section 3.1">3.1</a>
<li>active request contexts, <a href=#active-request-contexts title="section 3.1">3.1</a>
<li>assumed, <a href=#assumed-insecure-origin title="section 2.1">2.1</a>
<li>assumed insecure, <a href=#assumed-insecure-origin title="section 2.1">2.1</a>
<li>assumed insecure origin, <a href=#assumed-insecure-origin title="section 2.1">2.1</a>
<li>blockable, <a href=#blockable-passive-content title="section 3.2.2">3.2.2</a>
<li>blockable passive, <a href=#blockable-passive-content title="section 3.2.2">3.2.2</a>
<li>blockable passive content, <a href=#blockable-passive-content title="section 3.2.2">3.2.2</a>
<li>blockable passive request contexts, <a href=#blockable-passive-request-contexts title="section 3.2.2">3.2.2</a>
<li>client, <a href=#request-client title="section 2.2">2.2</a>
<li>context, <a href=#request-context title="section 2.2">2.2</a>
<li>fetch, <a href=#fetch title="section 2.2">2.2</a>
<li>globally unique identifier, <a href=#globally-unique-identifier title="section 2.2">2.2</a>
<li>mixed, <a href=#mixed-content title="section 2.1">2.1</a>
<li>mixed content, <a href=#mixed-content title="section 2.1">2.1</a>
<li>navigational request contexts, <a href=#navigational-request-contexts title="section 3">3</a>
<li>network error, <a href=#network-error title="section 2.2">2.2</a>
<li>optionally blockable, <a href=#optionally-blockable-passive-content title="section 3.2.1">3.2.1</a>
<li>optionally blockable passive, <a href=#optionally-blockable-passive-content title="section 3.2.1">3.2.1</a>
<li>optionally blockable passive content, <a href=#optionally-blockable-passive-content title="section 3.2.1">3.2.1</a>
<li>optionally blockable passive request contexts, <a href=#optionally-blockable-passive-request-contexts title="section 3.2.1">3.2.1</a>
<li>origin, <a href=#origin title="section 2.2">2.2</a>
<li>passive, <a href=#passive-content title="section 3.2">3.2</a>
<li>passive content, <a href=#passive-content title="section 3.2">3.2</a>
<li>plugin, <a href=#plugin title="section 2.2">2.2</a>
<li>proven, <a href=#proven-insecure-origin title="section 2.1">2.1</a>
<li>proven insecure, <a href=#proven-insecure-origin title="section 2.1">2.1</a>
<li>proven insecure origin, <a href=#proven-insecure-origin title="section 2.1">2.1</a>
<li>request, <a href=#request title="section 2.2">2.2</a>
<li>request client, <a href=#request-client title="section 2.2">2.2</a>
<li>request context, <a href=#request-context title="section 2.2">2.2</a>
<li>response, <a href=#response title="section 2.2">2.2</a>
<li>secure browsing context, <a href=#secure-browsing-context title="section 5.1">5.1</a>
<li>TLS-protected, <a href=#tls-protected title="section 2.2">2.2</a>
<li>weakly TLS-protected, <a href=#weakly-tls-protected title="section 2.2">2.2</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


<h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><div class=issue>Are these reasonable definitions that we want to run with?<a href=#issue-3c75cc41> ↵ </a></div>
    <div class=issue>This doesn’t currently process resources loaded via
    <code>&lt;link rel="subresource" ...&gt;</code> or
    <code>Link: ...; prefetch</code>. Perhaps we should?<a href=#issue-9a86d6f9> ↵ </a></div>
  <div class=issue>This is intended to cover cases in which a ServiceWorker
            responds to a request with an insecure resource. It’s not clear
            that this is the correct place to do that, however, as the
            integration with Fetch isn’t fully specified. It’s also not really
            clear what "insecure" should mean in a ServiceWorker context. We
            accept 'blob:' resources, for instance: should we accept responses
            synthesized by the service worker?<a href=#issue-7f528e67> ↵ </a></div>
          <div class=issue>Should we discuss mixed-pinning? (See
    <a href="https://code.google.com/p/chromium/issues/detail?id=259961">crbug.com/259961</a>
    for context).<a href=#issue-f2454bf1> ↵ </a></div>
  <div class=issue>Replace this section with some pointers to Fetch once we can get Fetch
  updated accordingly.<a href=#issue-51f86577> ↵ </a></div>

</div>