<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Mixed Content</title>
  <link href=../default.css rel=stylesheet type=text/css>
  <style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-ED") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
</head>
<body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.w3.org/>
    <img alt=W3C height=48 src=https://www.w3.org/Icons/w3c_home width=72>
</a>
</p>
  <h1 class="p-name no-ref" id=title>Mixed Content</h1>
  <h2 class="no-num no-toc no-ref heading settled" id=subtitle><span class=content>Editor’s Draft,
    <time class=dt-updated datetime=20141215>15 December 2014</time></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=https://w3c.github.io/webappsec/specs/mixedcontent/>https://w3c.github.io/webappsec/specs/mixedcontent/</a><dt>Latest version:<dd><a href=http://www.w3.org/TR/mixed-content/>http://www.w3.org/TR/mixed-content/</a><dt>Previous Versions:<dd><a href=http://www.w3.org/TR/2014/WD-mixed-content-20140722/ rel=previous>http://www.w3.org/TR/2014/WD-mixed-content-20140722/</a><dt>Version History:<dd><a href=https://github.com/w3c/webappsec/commits/master/specs/mixedcontent/index.src.html>https://github.com/w3c/webappsec/commits/master/specs/mixedcontent/index.src.html</a><dt>Feedback:<dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BMIX%5D%20feedback">public-webappsec@w3.org</a> with subject line “<kbd>[MIX] <var>… message topic …</var></kbd>” (<a href=http://lists.w3.org/Archives/Public/public-webappsec/ rel=discussion>archives</a>)</span><dt class=editor>Editor:<dd class=editor><div class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:mkwst@google.com>Mike West</a> (<span class="p-org org">Google Inc.</span>)</div></dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://www.w3.org/Consortium/Legal/ipr-notice#Copyright>Copyright</a> © 2014
  <a href=http://www.w3.org/><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
  (<a href=http://www.csail.mit.edu/><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
  <a href=http://www.ercim.eu/><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
  <a href=http://www.keio.ac.jp/>Keio</a>, <a href=http://ev.buaa.edu.cn/>Beihang</a>),

  All Rights Reserved.

  <abbr title="World Wide Web Consortium">W3C</abbr> <a href=http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer>liability</a>,
  <a href=http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks>trademark</a> and

  <a href=http://www.w3.org/Consortium/Legal/copyright-documents>document use</a>
  rules apply.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled" id=abstract><span class=content>Abstract</span></h2>
<div class=p-summary data-fill-with=abstract><p>This specification describes how a user agent should handle fetching of content loaded over unencrypted or unauthenticated connections in the context of an encrypted and authenticated document.</p>

</div>

<h2 class="no-num no-toc no-ref heading settled" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

<p>
  <strong>Changes to this document may be tracked at
  <a href=https://github.com/w3c/webappsec>https://github.com/w3c/webappsec</a>.</strong>

<p>
	The (<a href=http://lists.w3.org/Archives/Public/public-webappsec/>archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5BMIX%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href=http://www.w3.org/Mail/Request>instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “MIX” in the subject,
	preferably like this:
	“[MIX] <em>…summary of comment…</em>”

<p>
	This document was produced by the
  <a href=http://www.w3.org/2011/webappsec/>Web Application Security Working Group</a>.

<p>
	This document was produced by a group operating under
	the <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/>5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href=http://www.w3.org/2004/01/pp-impl/49309/status rel=disclosure>public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential>Essential Claim(s)</a>
	must disclose the information in accordance with <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure>section 6 of the W3C Patent Policy</a>.

<p>
  This document is governed by the <a href=http://www.w3.org/2014/Process-20140801/ id=w3c_process_revision>1 August 2014 W3C Process Document</a>.

</div>
<div data-fill-with=at-risk><p>The following features are at-risk, and may be dropped during the CR period:
<ul><li>The <a data-link-type=dfn href=#deprecated-tls-protection>deprecated TLS-protection</a> concept.</ul></div>

<h2 class="no-num no-toc no-ref heading settled" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents role=navigation><ul class=toc role=directory><li><a href=#intro><span class=secno>1</span> <span class=content>Introduction</span></a><li><a href=#terms><span class=secno>2</span> <span class=content>Key Concepts and Terminology</span></a><ul class=toc><li><a href=#terms-defined-here><span class=secno>2.1</span> <span class=content>Terms defined by this specification</span></a><li><a href=#terms-defined-by-reference><span class=secno>2.2</span> <span class=content>Terms defined by reference</span></a></ul><li><a href=#categories><span class=secno>3</span> <span class=content>Content Categories</span></a><ul class=toc><li><a href=#category-optionally-blockable><span class=secno>3.1</span> <span class=content>Optionally-blockable Content</span></a><li><a href=#category-blockable><span class=secno>3.2</span> <span class=content>Blockable Content</span></a></ul><li><a href=#strict-mode><span class=secno>4</span> <span class=content>Strict Mixed Content Checking</span></a><ul class=toc><li><a href=#strict-documents><span class=secno>4.1</span> <span class=content>Strict Documents</span></a><li><a href=#strict-nested-browsing-contexts><span class=secno>4.2</span> <span class=content>Strict Nested Browsing Contexts</span></a><li><a href=#htmliframeelement-modifications><span class=secno>4.3</span> <span class=content>
    Modifications to <code>HTMLIFrameElement</code>
  </span></a></ul><li><a href=#algorithms><span class=secno>5</span> <span class=content>Insecure Content in Secure Contexts</span></a><ul class=toc><li><a href=#categorize-settings-object><span class=secno>5.1</span> <span class=content>
      Does <var>settings object</var> restrict mixed content?
    </span></a><li><a href=#should-block-fetch><span class=secno>5.2</span> <span class=content>
      Should fetching <var>request</var> be blocked as mixed content?
    </span></a><li><a href=#should-block-response><span class=secno>5.3</span> <span class=content>
      Should <var>response</var> to <var>request</var> be blocked as mixed
      content?
    </span></a></ul><li><a href=#websockets-integration><span class=secno>6</span> <span class=content>Modifications to WebSockets</span></a><li><a href=#security-considerations><span class=secno>7</span> <span class=content>Security Considerations</span></a><ul class=toc><li><a href=#requirements-forms><span class=secno>7.1</span> <span class=content>Form Submission</span></a><li><a href=#requirements-ux><span class=secno>7.2</span> <span class=content>UI Requirements</span></a><li><a href=#requirements-user-controls><span class=secno>7.3</span> <span class=content>User Controls</span></a><li><a href=#further-action><span class=secno>7.4</span> <span class=content>Further Action</span></a></ul><li><a href=#acknowledgements><span class=secno>8</span> <span class=content>Acknowledgements</span></a><li><a href=#conformance><span class=secno></span> <span class=content>Conformance</span></a><ul class=toc><li><a href=#conventions><span class=secno></span> <span class=content>Document conventions</span></a><li><a href=#conformant-algorithms><span class=secno></span> <span class=content>Conformant Algorithms</span></a><li><a href=#conformance-classes><span class=secno></span> <span class=content>Conformance Classes</span></a></ul><li><a href=#references><span class=secno></span> <span class=content>References</span></a><ul class=toc><li><a href=#normative><span class=secno></span> <span class=content>Normative References</span></a><li><a href=#informative><span class=secno></span> <span class=content>Informative References</span></a></ul><li><a href=#index><span class=secno></span> <span class=content>Index</span></a><li><a href=#idl-index><span class=secno></span> <span class=content>IDL Index</span></a></ul></div>
<main>











<section>
  <h2 class="heading settled" data-level=1 id=intro><span class=secno>1. </span><span class=content>Introduction</span><a class=self-link href=#intro></a></h2>

<p><em>This section is not normative.</em></p>

<p>When a user successfully loads a resource from example.com over a secure
  channel (HTTPS, for example), the user agent is able to make three assertions
  critical to the user’s security and privacy:</p>

  <ul>
    <li>
      The user is communicating with a server that is allowed to claim to be
      <code>example.com</code>, and not one of the many, many servers through
      which her request has hopped. The connection can be
      <strong>authenticated</strong>.
    </li>
    <li>
      The user’s communications with <code>example.com</code> cannot be
      trivially eavesdropped upon by middlemen, because the requests she makes
      and the responses she receives are <strong>encrypted</strong>.
    </li>
    <li>
      The user’s communications with <code>example.com</code> cannot be
      trivially modified by middlemen, the encryption and authentication
      provide a guarantee of <strong>data integrity</strong>.
    </li>
  </ul>

<p>Together, these assertions give the user some assurance that
  <code>example.com</code> is the only entity that can read and respond to her
  requests (caveat: without shocking amounts of work) and that the bits she’s
  received are indeed those that <code>example.com</code> actually sent.</p>

<p>The strength of these assertions is substantially weakened, however, when
  the encrypted and authenticated resource requests subresources (scripts,
  images, etc) over an insecure channel. Those resource requests result in a
  resource whose status is mixed, as insecure requests are wide open for
  man-in-the-middle attacks. This scenario is unfortunately quite common.</p>

<p>This specification details how a user agent can mitigate these risks to
  security and privacy by limiting a resource’s ability to inadvertently
  communicate in the clear.</p>

<p class=note role=note>Note: Nothing described in this document is really new; everything covered
  here has appeared in one or more a user agent over the years: Internet
  Explorer led the way, alerting users to mixed content since at least
  version 4.</p>
</section>


<section>
  <h2 class="heading settled" data-level=2 id=terms><span class=secno>2. </span><span class=content>Key Concepts and Terminology</span><a class=self-link href=#terms></a></h2>

  <h3 class="heading settled" data-level=2.1 id=terms-defined-here><span class=secno>2.1. </span><span class=content>Terms defined by this specification</span><a class=self-link href=#terms-defined-here></a></h3>
  <dl>
    <dt>
      <dfn data-dfn-type=dfn data-export="" data-local-title=mixed id=mixed-content>mixed content<a class=self-link href=#mixed-content></a></dfn>
    </dt>
    <dd>
      A resource is said to be <strong>mixed content</strong> if the resource’s
      <a data-link-type=dfn href=#origin>origin</a> is <a data-link-type=dfn href=#insecure-origin>insecure</a>, <strong>and</strong> the context
      responsible for loading it restricts mixed content. See
      <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> for a normative definition of the latter.

      <div class=example>
        The image <code>http://example.com/image.png</code> is <strong>mixed
        content</strong> when loaded by
        <code>https://not.example.com/</code>.
      </div>
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" data-local-title="potentially secure" id=potentially-secure-origin>
        potentially secure origin
      <a class=self-link href=#potentially-secure-origin></a></dfn>
    </dt>
    <dt>
      <dfn data-dfn-type=dfn data-export="" id=potentially-secure-url>
        potentially secure URL
      <a class=self-link href=#potentially-secure-url></a></dfn>
    </dt>
    <dd>
      An <a data-link-type=dfn href=#origin>origin</a> is said to be <strong>potentially secure</strong>
      if the origin’s scheme component is <code>HTTPS</code>, <code>WSS</code>,
      or <code>about</code>.

<p>A URL whose <a data-link-type=dfn href=#origin>origin</a> is potentially secure is itself considered to
      be potentially secure.</p>
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" data-local-title="a priori insecure" id=a-priori-insecure-origin>
        <em>a priori</em> insecure origin
      <a class=self-link href=#a-priori-insecure-origin></a></dfn>
    </dt>
    <dt>
      <dfn data-dfn-type=dfn data-export="" id=a-priori-insecure-url>
        <em>a priori</em> insecure URL
      <a class=self-link href=#a-priori-insecure-url></a></dfn>
    </dt>
    <dd>
      Any <a data-link-type=dfn href=#origin>origin</a> which is not <a data-link-type=dfn href=#potentially-secure-origin>potentially secure</a> is said to
      be <strong><em>a priori</em> insecure</strong>. We know, for example, that
      <code>http://example.com/</code> is insecure just by looking at its scheme
      component.

<p>A URL whose <a data-link-type=dfn href=#origin>origin</a> is <em>a priori</em> insecure is itself
      considered to be <em>a priori</em> insecure.</p>
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" data-local-title=insecure id=insecure-origin>
        insecure origin
      <a class=self-link href=#insecure-origin></a></dfn>
    </dt>
    <dt>
      <dfn data-dfn-type=dfn data-export="" id=insecure-url>
        insecure URL
      <a class=self-link href=#insecure-url></a></dfn>
    </dt>
    <dd>
      An resource’s origin is said to be <strong>insecure</strong> if it is
      either <a data-link-type=dfn href=#a-priori-insecure-origin><em>a priori</em> insecure</a>, or the user agent discovers
      only after performing a TLS-handshake that the TLS-protection offered
      is <a data-link-type=dfn href=#deprecated-tls-protection>deprecated</a>.

<p>A URL whose <a data-link-type=dfn href=#origin>origin</a> is insecure is itself considered to be insecure.</p>
    </dd>

    <dt>
      <dfn data-dfn-type=dfn data-export="" data-local-title=deprecated id=deprecated-tls-protection>
        deprecated TLS-protection
      <a class=self-link href=#deprecated-tls-protection></a></dfn>
    </dt>
    <dd>
      A resource’s TLS-protection is said to be <strong>deprecated</strong> if
      a user agent refuses to trust the resource’s TLS handshake. This
      determination is vendor-specific.

<p>For example, a user agent may choose to reject resources for which the
      server presented a publicly-trusted certificate for an "Internal
      Name" (e.g. <code>https://intranet/</code>), a certificate with an
      overly-long validity period, a certificate with a weak cipher suite, a
      certificate signed with SHA-1, or a certificate which otherwise fails
      to meet the CA/Browser Forum’s Baseline Requirements <a data-biblio-type=normative data-link-type=biblio href=#biblio-cab title=CAB>[CAB]</a>.</p>

<p class=note role=note>Note: We recommend that a user agent return network errors rather than
      fetching resources whose TLS-protection is deprecated.</p>

<p class=note role=note>Note: <a data-biblio-type=informative data-link-type=biblio href=#biblio-wsc-ui title=WSC-UI>[WSC-UI]</a> defines "weakly TLS-protected", which is <i>de facto</i>
      included in user agents' interpretation of what "deprecated" means.</p>
    </dd>
  </dl>

  <h3 class="heading settled" data-level=2.2 id=terms-defined-by-reference><span class=secno>2.2. </span><span class=content>Terms defined by reference</span><a class=self-link href=#terms-defined-by-reference></a></h3>
  <dl>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=origin>origin<a class=self-link href=#origin></a></dfn></dt>
    <dd>
      An origin defines the scope of authority or privilege under which a
      resource operates. It is defined in detail in the Origin specification
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6454 title=RFC6454>[RFC6454]</a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=globally-unique-identifier>globally unique identifier<a class=self-link href=#globally-unique-identifier></a></dfn></dt>
    <dd>
      This term is defined in
      <a href=http://tools.ietf.org/html/rfc6454#section-4>Section 4 of
      RFC6454</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6454 title=RFC6454>[RFC6454]</a>.

<p class=note role=note>Note: URLs that do not use
      <a href=http://tools.ietf.org/html/rfc3986#section-3.2>hierarchical
      elements</a> as naming authorities (for example: <code>blob:</code>, and
      <code>data:</code>) have origins which are globally unique identifiers
      <a data-biblio-type=informative data-link-type=biblio href=#biblio-uri title=URI>[URI]</a>.</p>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=fetch>fetch<a class=self-link href=#fetch></a></dfn></dt>
    <dd>
      "fetching" is the process by which a user agent requests resources, and
      delivers responses. It is defined in detail in the Fetch living standard
      <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=request>request<a class=self-link href=#request></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-local-title=client data-noexport="" id=request-client>request client<a class=self-link href=#request-client></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-local-title=context data-noexport="" id=request-context>request context<a class=self-link href=#request-context></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-local-title="frame type" data-noexport="" id=request-context-frame-type>request context frame type<a class=self-link href=#request-context-frame-type></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-local-title="tls state" data-noexport="" id=request-client-tls-state>request client TLS state<a class=self-link href=#request-client-tls-state></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=response-tls-state>response TLS state<a class=self-link href=#response-tls-state></a></dfn></dt>
    <dd>
      These terms are defined in
      <a href=http://fetch.spec.whatwg.org/#requests>Section 2.2</a> of the
      Fetch living standard <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=response>response<a class=self-link href=#response></a></dfn></dt>
    <dt><dfn data-dfn-type=dfn data-noexport="" id=network-error>network error<a class=self-link href=#network-error></a></dfn></dt>
    <dd>
      These terms are defined in detail in
      <a href=http://fetch.spec.whatwg.org/#responses>Section 2.3</a> of the
      Fetch living standard <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=environment-settings-object>environment settings object<a class=self-link href=#environment-settings-object></a></dfn></dt>
    <dd>
      Defined in <a data-biblio-type=normative data-link-type=biblio href=#biblio-html5 title=HTML5>[HTML5]</a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=embedding-document>embedding document<a class=self-link href=#embedding-document></a></dfn></dt>
    <dd>
      Given a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code> <var>A</var>, the <strong>embedding
      document</strong> of <var>A</var> is the <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code>
      <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-nested-through title="nested through">through which</a> <var>A</var>’s <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context title="browsing context">browsing
      context</a> is nested.
    </dd>
  </dl>
</section>


<section>
  <h2 class="heading settled" data-level=3 id=categories><span class=secno>3. </span><span class=content>Content Categories</span><a class=self-link href=#categories></a></h2>

<p>In a perfect world, each user agent would be required to block all <a data-link-type=dfn href=#mixed-content title="mixed content">mixed
  content</a> without exception. Unfortunately, that is impractical on today’s
  Internet; a user agent needs to be more nuanced in its restrictions to avoid
  degrading the experience on a substantial number of websites.</p>

<p>With that in mind, we here split mixed content into two categories:
  <a data-section="" href=#category-optionally-blockable>§3.1 Optionally-blockable Content</a> and <a data-section="" href=#category-blockable>§3.2 Blockable Content</a>.</p>

<p class=note role=note>Note: Future versions of this specification will update this categorization
  with the intent of moving towards a world where all <a data-link-type=dfn href=#mixed-content>mixed</a> content is
  blocked; that is the end goal, but this is the best we can do for now.</p>

  <section>
    <h3 class="heading settled" data-level=3.1 id=category-optionally-blockable><span class=secno>3.1. </span><span class=content>Optionally-blockable Content</span><a class=self-link href=#category-optionally-blockable></a></h3>

<p>A resource is
    <dfn data-dfn-type=dfn data-local-title=optionally-blockable data-noexport="" id=optionally-blockable-content>optionally-blockable content<a class=self-link href=#optionally-blockable-content></a></dfn>
    when the risk of allowing its usage as <a data-link-type=dfn href=#mixed-content>mixed content</a> is outweighed by
    the risk of breaking significant portions of the web. This could be because
    mixed usage of the resource type is sufficiently high, and because the
    resource is low-risk in and of itself. The fact that these resource types
    are optionally-blockable does not mean that they are <em>safe</em>, simply
    that they’re less catastrophically dangerous than other resource types. For
    example, images and icons are often the central UI elements in an
    application’s interface. If an attacker reversed the "Delete email" and
    "Reply" icons, there would be real impact to users.</p>

<p>This category of content includes:</p>

    <ul>
      <li>
        Images loaded via <a data-link-type=element href=https://html.spec.whatwg.org/#the-img-element>img</a>

<p class=note role=note>Note: This includes SVG documents loaded as images, as they are banned from
        executing script or loading subresources.</p>
      </li>
      <li>
        Video loaded via <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-video-element>video</a> and <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-source-element>source</a>
      </li>
      <li>
        Audio loaded via <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-audio-element>audio</a> and <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-source-element>source</a>
      </li>
      <li>
        <a href=http://www.w3.org/TR/html5/links.html#link-type-prefetch>Prefetched</a>
        content <a data-biblio-type=normative data-link-type=biblio href=#biblio-html5 title=HTML5>[HTML5]</a>
      </li>
    </ul>

<p>These resource types map to the following Fetch <a data-link-type=dfn href=#request-context>request contexts</a>:
    <code>audio</code>, <code>image</code>, <code>prefetch</code>, and
    <code>video</code>. These contexts are <dfn data-dfn-type=dfn data-noexport="" id=optionally-blockable-request-contexts>optionally-blockable request
    contexts<a class=self-link href=#optionally-blockable-request-contexts></a></dfn>.</p>

<p class=note role=note>Note: We further limit this category in <a data-section="" href=#should-block-fetch>§5.2 
      Should fetching request be blocked as mixed content?
    </a> by
    force-failing any CORS-enabled request. This means that mixed content images
    loaded via <code>&lt;img crossorigin ...&gt;</code> will be blocked. This is
    a good example of the general principle that a category of content falls
    into this category <em>only</em> when it is too widely used to be blocked
    outright. The Working Group intends to find more blockable subsets of an
    otherwise <a data-link-type=dfn href=#optionally-blockable-request-contexts>optionally-blockable request context</a>.</p>
  </section>

  <section>
    <h3 class="heading settled" data-level=3.2 id=category-blockable><span class=secno>3.2. </span><span class=content>Blockable Content</span><a class=self-link href=#category-blockable></a></h3>

<p>Any resource that isn’t <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> is
    <dfn data-dfn-type=dfn data-local-title=blockable data-noexport="" id=blockable-content title="blockable content">blockable
    content<a class=self-link href=#blockable-content></a></dfn>. Typical examples of this kind of content include scripts,
    <a data-link-type=dfn href=http://www.w3.org/TR/html5/infrastructure.html#plugin>plugin</a> data, data requested via XMLHttpRequest, and so on. Every
    <a data-link-type=dfn href=#request-context>request context</a> that is not <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> is a
    <dfn data-dfn-type=dfn data-noexport="" id=blockable-request-context>blockable request context<a class=self-link href=#blockable-request-context></a></dfn>. This explicitly includes any contexts
    defined after publication of this document.</p>

<p class=note role=note>Note: The request contexts <code>form</code>, <code>hyperlink</code>, and
    <code>location</code> might refer to <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top-level browsing context</a>
    <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#navigate title=navigated>navigations</a>, which are not considered mixed
    content. See the treatment of <a data-link-type=dfn href=#request-context-frame-type>request context frame type</a> in
    <a data-section="" href=#should-block-fetch>§5.2 
      Should fetching request be blocked as mixed content?
    </a> for details.</p>
  </section>
</section>


<section>
  <h2 class="heading settled" data-level=4 id=strict-mode><span class=secno>4. </span><span class=content>Strict Mixed Content Checking</span><a class=self-link href=#strict-mode></a></h2>

<p>In order to give authors assurance that mixed content will never degrade the
  security UI presented to their users (as described in <a data-section="" href=#requirements-ux>§7.2 UI Requirements</a>),
  authors may opt into stricter mixed content checking which will both block
  <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> and <a data-link-type=dfn href=#blockable-content>blockable</a> mixed content, and suppress
  user override options discussed in <a data-section="" href=#requirements-user-controls>§7.3 User Controls</a>.</p>

<p>To this end, <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code> objects and <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context>browsing contexts</a> have a
  <dfn data-dfn-type=dfn data-noexport="" id=strict-mixed-content-checking-flag>strict mixed content checking flag<a class=self-link href=#strict-mixed-content-checking-flag></a></dfn> which is set to
  <code>false</code> unless otherwise specified. This flag is checked in both
  <a data-section="" href=#should-block-fetch>§5.2 
      Should fetching request be blocked as mixed content?
    </a> and <a data-section="" href=#should-block-response>§5.3 
      Should response to request be blocked as mixed
      content?
    </a> to determine whether
  strict checking is in place. The flag is set as follows:</p>

  <h3 class="heading settled" data-level=4.1 id=strict-documents><span class=secno>4.1. </span><span class=content>Strict Documents</span><a class=self-link href=#strict-documents></a></h3>

<p>Authors may opt a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code> into strict mixed content checking via a
  <dfn data-dfn-type=dfn data-noexport="" id=strict-mixed-content-checking-directive title=strict-mixed-content-checking-directive>strict-mixed-content-checking<a class=self-link href=#strict-mixed-content-checking-directive></a></dfn>
  Content Security Policy directive <a data-biblio-type=informative data-link-type=biblio href=#biblio-csp title=CSP>[CSP]</a>, defined via the following ABNF
  grammar.</p>

  <pre>directive-name  = "strict-mixed-content-checking"
directive-value = ""
</pre>

<p>When <a data-link-type=dfn href=https://w3c.github.io/webappsec/specs/content-security-policy/>enforcing</a> the <code>strict-mixed-content-checking</code>
  directive, set the protected resource’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag title="strict mixed content checking flag">strict mixed content checking
  flag</a> to <code>true</code>.</p>

<p>This directive has no effect when <a data-link-type=dfn href=https://w3c.github.io/webappsec/specs/content-security-policy/>monitored</a>.</p>

<p class=note role=note>Note: A similar effect may be achieved on a more granular level by setting
  individual directives. For example <code>img-src https:</code> would prevent
  insecure images from loading.</p>

<p><code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code>s may also be put into strict mixed content checking mode by
  inheriting the setting from an ancestor: When <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#create-a-document-object title="creating a new Document object">creating a new
  <code>Document</code> object</a>, set its <a data-link-type=dfn href=#strict-mixed-content-checking-flag title="strict mixed content checking flag">strict mixed content checking
  flag</a> to <code>true</code> if its <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context>browsing context</a>’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag title="strict mixed content checking flag">strict mixed
  content checking flag</a> is <code>true</code>.</p>

  <h3 class="heading settled" data-level=4.2 id=strict-nested-browsing-contexts><span class=secno>4.2. </span><span class=content>Strict Nested Browsing Contexts</span><a class=self-link href=#strict-nested-browsing-contexts></a></h3>

<p>Authors may wish to ensure that content embedded from untrusted sources cannot
  degrade their pages' security UI. They may do so by adding a
  <dfn data-dfn-for=iframe data-dfn-type=element-attr data-export="" id=element-attrdef-iframe-strict-mixed-content-checking>strict-mixed-content-checking<a class=self-link href=#element-attrdef-iframe-strict-mixed-content-checking></a></dfn> attribute
  to <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element>iframe</a> elements. Doing so will ensure that the embedded
  document will be strictly checked.</p>

<p class=note role=note>Note: Similar to the <a data-link-for=iframe data-link-type=element-attr href=http://www.w3.org/TR/html5/embedded-content-0.html#attr-iframe-sandbox>sandbox</a> attribute, strict
  mixed content checking takes effect both on the embedding document
  <strong>and</strong> any of its descendents.</p>

<p>When a <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#nested-browsing-context>nested browsing context</a> <var>context</var> is created, set its
  <a data-link-type=dfn href=#strict-mixed-content-checking-flag>strict mixed content checking flag</a> to <code>true</code> if any of
  the following conditions are met:</p>

  <ol>
    <li>
      <var>context</var>’s <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-container>browsing context container</a> is an
      <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element>iframe</a> with the
      <a data-link-for=iframe data-link-type=element-attr href=#element-attrdef-iframe-strict-mixed-content-checking>strict-mixed-content-checking</a> attribute
      set to <code>true</code>.
    </li>
    <li>
      <var>context</var>’s <a data-link-type=dfn href=#embedding-document>embedding document</a>’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag title="strict mixed content checking flag">strict mixed content
      checking flag</a> is set to <code>true</code>.
    </li>
  </ol>

<p>When an <a data-link-type=element href=http://www.w3.org/TR/html5/embedded-content-0.html#the-iframe-element>iframe</a> element’s
  <a data-link-for=iframe data-link-type=element-attr href=#element-attrdef-iframe-strict-mixed-content-checking>strict-mixed-content-checking</a> attribute is
  set while it has a <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#nested-browsing-context>nested browsing context</a> <var>context</var>, set
  <var>context</var>’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag>strict mixed content checking flag</a> to
  <code>true</code>.</p>

  <h3 class="heading settled" data-level=4.3 id=htmliframeelement-modifications><span class=secno>4.3. </span><span class=content>
    Modifications to <code>HTMLIFrameElement</code>
  </span><a class=self-link href=#htmliframeelement-modifications></a></h3>

  <pre class=idl>partial interface <a class=idl-code data-global-name="" data-link-type=interface href=https://html.spec.whatwg.org/#htmliframeelement>HTMLIFrameElement</a> {
  readonly attribute boolean <a class=idl-code data-global-name="HTMLIFrameElement<interface>/strictmixedcontentchecking<attribute>" data-link-for=HTMLIFrameElement data-link-type=attribute data-readonly="" data-type="boolean " href=#dom-htmliframeelement-strictmixedcontentchecking>strictMixedContentChecking</a>;
};
</pre>
  <dl data-dfn-for=HTMLIFrameElement>
    <dt><dfn class=idl-code data-dfn-for=HTMLIFrameElement data-dfn-type=attribute data-export="" id=dom-htmliframeelement-strictmixedcontentchecking>strictMixedContentChecking<a class=self-link href=#dom-htmliframeelement-strictmixedcontentchecking></a></dfn>, <span data-attribute-info="" for=HTMLIFrameElement/strictMixedContentChecking> of type <a data-link-type=idl-name>boolean</a>, readonly</span></dt>
    <dd>This attribute <a data-link-type=dfn href=http://www.w3.org/TR/html5/infrastructure.html#reflect>reflects</a> the value of the
    element’s
    <code><a data-link-for=iframe data-link-type=element-attr href=#element-attrdef-iframe-strict-mixed-content-checking>strict-mixed-content-checking</a></code>
    content attribute.</dd>
  </dl>
</section>


<section>
  <h2 class="heading settled" data-level=5 id=algorithms><span class=secno>5. </span><span class=content>Insecure Content in Secure Contexts</span><a class=self-link href=#algorithms></a></h2>

<p>At a high level, the following algorithms allow user agents to determine
  whether particular requests should succeed, or should result in network
  errors.</p>

<p>Fetch calls the algorithm defined in
  <a data-section="" href=#should-block-fetch>§5.2 
      Should fetching request be blocked as mixed content?
    </a> during
  <a href=http://fetch.spec.whatwg.org/#fetching>Step 4 of the Fetching
  algorithm</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a> in order to block network traffic to <a data-link-type=dfn href=#a-priori-insecure-origin title="a priori insecure origins"><em>a
  priori</em> insecure origins</a>.</p>

<p class=note role=note>Note: Hooking into Fetch here ensures that we catch not only the initial
  request, but all redirects as well. That is certainly the intent.</p>

<p>Further, Fetch calls the algorithm defined in
  <a data-section="" href=#should-block-response>§5.3 
      Should response to request be blocked as mixed
      content?
    </a> during
  <a href=http://fetch.spec.whatwg.org/#fetching>Step 7 of the Fetching
  algorithm</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a> in order to block responses from <a data-link-type=dfn href=#insecure-origin title="insecure origins">insecure
  origins</a>.</p>

<p class=note role=note>Note: This hook is necessary to detect resources modified or
  synthesized by a ServiceWorker, as well as to determine whether a
  resource is <a data-link-type=dfn href=#insecure-origin>insecure</a> once the TLS-handshake has finished. See
  steps 4.1 and 4.2 of the algorithm defined in <a data-section="" href=#should-block-response>§5.3 
      Should response to request be blocked as mixed
      content?
    </a> for
  detail.</p>

<p>The algorithm defined in <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> is used by both
  <a data-section="" href=#should-block-fetch>§5.2 
      Should fetching request be blocked as mixed content?
    </a> and <a data-section="" href=#should-block-response>§5.3 
      Should response to request be blocked as mixed
      content?
    </a>, as well as
  <a data-section="" href=#websockets-integration>§6 Modifications to WebSockets</a> in order to determine whether an insecure request
  ought to be blocked.</p>

  <section>
    <h3 class="heading settled" data-level=5.1 id=categorize-settings-object><span class=secno>5.1. </span><span class=content>
      Does <var>settings object</var> restrict mixed content?
    </span><a class=self-link href=#categorize-settings-object></a></h3>

<p>Both documents and workers have <a data-link-type=dfn href=#environment-settings-object>environment settings objects</a> which
    may be examined according to the following algorithm in order to determine
    whether they restrict mixed content. This algorithm returns <code>Restricts
    Mixed Content</code> or <code>Does Not Restrict Mixed Content</code>, as
    appropriate.</p>

<p>Given an <a data-link-type=dfn href=#environment-settings-object>environment settings object</a> <var>settings</var>:</p>

    <ol>
      <li>
        If <var>settings</var>' <a data-link-type=dfn href=#request-client-tls-state>TLS state</a> is not
        <code>unauthenticated</code>, then return <strong>Restricts Mixed
        Content</strong>.
      </li>
      <li>
        If <var>settings</var> has a <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#responsible-document>responsible document</a>
        <var>document</var>, then:

        <ol>
          <li>
            While <var>document</var> has an <a data-link-type=dfn href=#embedding-document>embedding document</a>:

            <ol>
              <li>
                Let <var>document</var> be <var>document</var>’s <a data-link-type=dfn href=#embedding-document title="embedding document">embedding
                document</a>.
              </li>
              <li>
                Let <var>embedder settings</var> be <var>document</var>’s
                <var>incumbent settings object</var>.
              </li>
              <li>
                If <var>embedder settings</var>' <a data-link-type=dfn href=#request-client-tls-state>TLS state</a> is not
                <code>unauthenticated</code>, then return <strong>Restricts
                mixed content</strong>.
              </li>
            </ol>
          </li>
        </ol>
      </li>
      <li>Return <strong>Does Not Restrict Mixed Content</strong>.</li>
    </ol>

    <div class=note role=note>
      If a document has an <a data-link-type=dfn href=#embedding-document>embedding document</a>, a user agent needs to
      check not only the document itself, but also the <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context title="top-level browsing context">top-level browsing
      context</a> in which the document is nested, as that is the context
      which controls the user’s expectations regarding the security status of
      the resource she’s loaded. For example:

      <div class=example>
        <code>http://a.com</code> loads <code>http://evil.com</code>. The
        insecure request will be allowed, as <code>a.com</code> was not loaded
        over a secure connection.
      </div>

      <div class=example>
        <code>https://a.com</code> loads <code>http://evil.com</code>. The
        insecure request will be blocked, as <code>a.com</code> was loaded over
        a secure connection.
      </div>

      <div class=example>
        <code>http://a.com</code> frames <code>https://b.com</code>, which
        loads <code>http://evil.com</code>. In this case, the insecure request
        to <code>evil.com</code> will be blocked, as <code>b.com</code> was
        loaded over a secure connection, even though <code>a.com</code> was not.
      </div>

      <div class=example>
        <code>https://a.com</code> frames a <code>data:</code> URL, which loads
        <code>http://evil.com</code>. In this case, the insecure request to
        <code>evil.com</code> will be blocked, as <code>a.com</code> was loaded
        over a secure connection, even though the framed data URL was not.
      </div>
    </div>
  </section>

  <section>
    <h3 class="heading settled" data-level=5.2 id=should-block-fetch><span class=secno>5.2. </span><span class=content>
      Should fetching <var>request</var> be blocked as mixed content?
    </span><a class=self-link href=#should-block-fetch></a></h3>

<p class=note role=note>Note: The Fetch specification hooks into this algorithm to determine whether
    a request should be entirely blocked (e.g. because the request is for
    <a data-link-type=dfn href=#blockable-content>blockable</a> content, and we can <em>assume</em> that it won’t be
    loaded over a secure connection).</p>

<p>Given a <a data-link-type=dfn href=#request>Request</a> <var>request</var>, a user agent determines
    whether the <a data-link-type=dfn href=#request>Request</a> <var>request</var> should proceed or not via the
    following algorithm:</p>

    <ol>
      <li>
        Let <var>context</var> be <var>request</var>’s <code>context</code>.
      </li>
      <li>
        Let <var>frame type</var> be <var>request</var>’s <code>context frame
        type</code>.
      </li>
      <li>
        Let <var>origin</var> be the <a data-link-type=dfn href=#origin>origin</a> of <var>request</var>’s
        <strong>URL</strong>.
      </li>
      <li>
        If <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> returns <code>Does Not Restrict
        Mixed Content</code> when applied to <var>request</var>’s <a data-link-type=dfn href=#request-client>client</a>,
        return <strong>allowed</strong>.
      </li>
      <li>
        If the user agent has been instructed to allow <a data-link-type=dfn href=#mixed-content>mixed content</a>
        (as outlined in <a data-section="" href=#requirements-user-controls>§7.3 User Controls</a>), return
        <strong>allowed</strong>.
      </li>
      <li>
        If <var>request</var>’s <code>context frame type</code> is
        <code>top-level</code>, return <strong>allowed</strong>.
      </li>
      <li>
        If <var>origin</var> is <a data-link-type=dfn href=#a-priori-insecure-origin><em>a priori</em> insecure</a>:

        <ol>
          <li>
            If <var>request</var>’s <code>mode</code> is <code>CORS</code> or
            <code>CORS-with-forced-preflight</code>, return
            <strong>blocked</strong>.
          </li>
          <li>
            If <var>context</var> is not an <a data-link-type=dfn href=#optionally-blockable-request-contexts title="optionally-blockable request context">optionally-blockable request
            context</a>, return <strong>blocked</strong>.
          </li>
          <li>
            If the user agent is configured to block <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a>
            mixed content, return <strong>blocked</strong>.
          </li>
          <li>
            If <var>request</var>’s <a data-link-type=dfn href=#request-client>client</a>’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag title="strict mixed content checking flag">strict mixed content
            checking flag</a> is <code>true</code>, return
            <strong>blocked</strong>.
          </li>
        </ol>
      </li>
      <li>
        Otherwise, <var>origin</var> is <a data-link-type=dfn href=#potentially-secure-origin>potentially secure</a>, so
        return <strong>allowed</strong>.
      </li>
    </ol>
  </section>

  <section>
    <h3 class="heading settled" data-level=5.3 id=should-block-response><span class=secno>5.3. </span><span class=content>
      Should <var>response</var> to <var>request</var> be blocked as mixed
      content?
    </span><a class=self-link href=#should-block-response></a></h3>

<p class=note role=note>Note: <a href=#should-block-fetch>If a request proceeds</a>, we still
    might want to block the response based on the state of the connection
    that generated the response (e.g. because the response is for <a data-link-type=dfn href=#blockable-content title="blockable content">blockable
    content</a>, but the connection is <a data-link-type=dfn href=#insecure-origin>insecure</a>). This algorithm is used
    to make that determination.</p>

<p>Given a <a data-link-type=dfn href=#request>request</a> <var>request</var> and <a data-link-type=dfn href=#response>response</a>
    <var>response</var>, the user agent determines what response should be
    returned via the following algorithm:</p>

    <ol>
      <li>
        If <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> returns <code>Does Not Restrict
        Mixed Content</code> when applied to <var>request</var>’s <a data-link-type=dfn href=#request-client>client</a>,
        return <strong>allowed</strong>.
      </li>
      <li>
        If the user agent has been instructed to allow <a data-link-type=dfn href=#mixed-content>mixed content</a>
        (as outlined in <a data-section="" href=#requirements-user-controls>§7.3 User Controls</a>), return
        <strong>allowed</strong>.
      </li>
      <li>
        Let <var>context</var> be the <a data-link-type=dfn href=#request-context>request context</a> of
        <var>request</var>.
      </li>
      <li>
        If <var>context</var> is not an <a data-link-type=dfn href=#optionally-blockable-request-contexts title="optionally-blockable request context">optionally-blockable request
        context</a>, or the user agent is configured to block
        <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> mixed content, or  <var>request</var>’s
        <a data-link-type=dfn href=#request-client>client</a>’s <a data-link-type=dfn href=#strict-mixed-content-checking-flag>strict mixed content checking flag</a> is
        <code>true</code>:

        <ol>
          <li>
            If <var>response</var>’s <a data-link-type=dfn href=#request-client-tls-state>TLS state</a> is not
            <code>authenticated</code>, return <strong>blocked</strong>.

<p class=note role=note>Note: This covers both cases in which unauthenticated resources are
            requested, as well as cases in which the TLS handshake succeeds,
            but the user agent chooses to hold it to a higher standard. The
            definition of <a data-link-type=dfn href=#deprecated-tls-protection>deprecated TLS-protection</a> has some examples of
            these kinds of scenarios.</p>
          </li>
        </ol>
      </li>
      <li>Return <strong>allowed</strong>.</li>
    </ol>
  </section>
</section>


<section>
  <h2 class="heading settled" data-level=6 id=websockets-integration><span class=secno>6. </span><span class=content>Modifications to WebSockets</span><a class=self-link href=#websockets-integration></a></h2>

<p>The <a href=http://www.w3.org/TR/2012/CR-websockets-20120920/#the-websocket-interface><code>WebSocket()</code>
  constructor algorithm</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-websockets title=WEBSOCKETS>[WEBSOCKETS]</a> is modified as follows:</p>

  <ul>
    <li>
      Replace Step 2 with the following steps:

      <ol>
        <li>
          If <var>secure</var> is <strong>false</strong>, and the algorithm in
          <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> returns <code>Restricts Mixed
          Content</code> when applied to <var>entry script</var>’s
          <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#relevant-settings-object-for-a-script title="relevant settings object for a script">relevant settings
          object</a>’s, then throw a <code>SecurityError</code> exception.
        </li>
      </ol>
    </li>
  </ul>

<p>The <a href=http://tools.ietf.org/html/rfc6455#section-4.1>Establish a
  WebSocket Connection algorithm</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6455 title=RFC6455>[RFC6455]</a> is modified as follows:</p>

  <ul>
    <li>
      After step 5, perform the following step:

      <ol>
        <li>
          If secure is <strong>true</strong>, and the TLS handshake performed
          in step 5 results in TLS-protection which is is <a data-link-type=dfn href=#deprecated-tls-protection>deprecated</a>,
          then the client MUST
          <a href=http://tools.ietf.org/html/rfc6455#section-7.1.7>Fail the
          WebSocket Connection</a> and abort the connection <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6455 title=RFC6455>[RFC6455]</a>.
        </li>
      </ol>
    </li>
  </ul>
</section>


<section>
  <h2 class="heading settled" data-level=7 id=security-considerations><span class=secno>7. </span><span class=content>Security Considerations</span><a class=self-link href=#security-considerations></a></h2>

  <section>
    <h3 class="heading settled" data-level=7.1 id=requirements-forms><span class=secno>7.1. </span><span class=content>Form Submission</span><a class=self-link href=#requirements-forms></a></h3>

<p>If <a data-section="" href=#categorize-settings-object>§5.1 
      Does settings object restrict mixed content?
    </a> returns <code>Restricts Mixed
    Content</code> when applied to a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code>'s <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object title="incumbent settings object">incumbent settings
    object</a>, then a user agent MAY choose to warn users of the presence of
    one or more <a data-link-type=element href=https://html.spec.whatwg.org/#the-form-element>form</a> elements with <a data-link-type=element-attr href=https://html.spec.whatwg.org/#attr-fs-action>action</a>
    attributes whose values are <a data-link-type=dfn href=#insecure-url>insecure URLs</a>.</p>

<p class=note role=note>Note: Chrome, for example, currently gives the same UI treatment to a page
    with an insecure form action as it does for a page that displays an insecure
    image.</p>

<p>Further, a user agent MAY treat form submissions from such a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object>Document</a></code>
    as a request for <a data-link-type=dfn href=#blockable-content>blockable content</a>, even if the submission occurs in
    the <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top-level browsing context</a>.</p>
  </section>

  <section>
    <h3 class="heading settled" data-level=7.2 id=requirements-ux><span class=secno>7.2. </span><span class=content>UI Requirements</span><a class=self-link href=#requirements-ux></a></h3>

<p>If a user agent would normally indicate to the user that the
    <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context>top-level browsing context</a> is secure, then when the user
    agent services a <a data-link-type=dfn href=#request>request</a> for an <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a>
    resource which is <a data-link-type=dfn href=#mixed-content>mixed content</a>, then the
    user agent MUST NOT provide the user with that same indication. The
    user agent SHOULD instead give an indication that <a data-link-type=dfn href=#mixed-content title="mixed content">mixed
    content</a> is present.</p>

<p>Any visible indicators of security state (for instance, a green lock icon)
    SHOULD also be made available through accessibility APIs for users of
    assistive technolgies.</p>

<p class=note role=note>Note: This requirement holds even in the context of an
    <a href=https://cabforum.org/about-ev-ssl/>EV status</a> <a data-biblio-type=normative data-link-type=biblio href=#biblio-cab title=CAB>[CAB]</a>. An EV
    certificate’s indicator does not override the necessity to notify
    users of mixed content violations.</p>
  </section>

  <section>
    <h3 class="heading settled" data-level=7.3 id=requirements-user-controls><span class=secno>7.3. </span><span class=content>User Controls</span><a class=self-link href=#requirements-user-controls></a></h3>

<p>A user agent MAY offer users the ability to directly decide whether or not
    to treat <strong>all</strong> <a data-link-type=dfn href=#mixed-content>mixed content</a> as <a data-link-type=dfn href=#blockable-content>blockable</a>
    (meaning that even <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> would be blocked in a
    mixed context).</p>

<p class=note role=note>Note: It is <em>strongly recommended</em> that users take advantage of such
    an option if provided.</p>

<p>A user agent MAY offer users the ability to override its decision to block
    <a data-link-type=dfn href=#blockable-content>blockable</a> mixed content on a particular page.</p>

<p class=note role=note>Note: Practically, a user agent probably can’t get away with not offering
    such a back door. That said, allowing mixed script is in particular a very
    dangerous option, and each user agent
    <a href=http://tools.ietf.org/html/rfc6919#section-3>REALLY SHOULD NOT</a>
    <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc6919 title=RFC6919>[RFC6919]</a> present such a choice to users without careful consideration and
    communication of the risk involved.</p>

<p>Any such controls offered by a user agent SHOULD also be offered through
    accessability APIs for users of assistive technologies.</p>
  </section>

  <section>
    <h3 class="heading settled" data-level=7.4 id=further-action><span class=secno>7.4. </span><span class=content>Further Action</span><a class=self-link href=#further-action></a></h3>

<p>A user agent is encouraged to take further action above and beyond the
    requirements this document outlines in order to discourage developers from
    embedding mixed content.</p>

<p>For instance, a user agent could:</p>

    <ol>
      <li>
        Interpret the presence of a <code>Strict-Transport-Security</code>
        header field as forcing all content into the <a data-link-type=dfn href=#blockable-content>blockable</a> category
        <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc6797 title=RFC6797>[RFC6797]</a>.
      </li>
      <li>
        Modify requests for <a data-link-type=dfn href=#optionally-blockable-content>optionally-blockable</a> resources which are
        <a data-link-type=dfn href=#mixed-content>mixed content</a> in order to reduce the risk to users: cookies
        and other authentication tokens could be stripped from the requests,
        automatic scheme upgrades could be attempted, and so on.
      </li>
    </ol>
  </section>
</section>


<section>
  <h2 class="heading settled" data-level=8 id=acknowledgements><span class=secno>8. </span><span class=content>Acknowledgements</span><a class=self-link href=#acknowledgements></a></h2>

<p>In addition to the wonderful feedback gathered from the WebAppSec WG, the
  Chrome security team was invaluable in preparing this specification. In
  particular, Chris Palmer, Chris Evans, Ryan Sleevi, Michal Zalewski, Ken
  Buchanan, and Tom Sepez gave lots of early feedback. Anne van Kesteren
  explained Fetch and helped define the interface to this specification.
  Brian Smith helped keep the spec focused, trim, and sane.</p>
</section>

</main>
<h2 class="no-ref no-num heading settled" id=conformance><span class=content>Conformance</span><a class=self-link href=#conformance></a></h2>

<h3 class="no-ref no-num heading settled" id=conventions><span class=content>Document conventions</span><a class=self-link href=#conventions></a></h3>

    <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc2119 title=RFC2119>[RFC2119]</a></p>

    <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    <div class=example>
        <p>This is an example of an informative example.</p>
    </div>

    <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    <p class=note role=note>Note, this is an informative note.</p>

<h3 class="no-ref no-num heading settled" id=conformant-algorithms><span class=content>Conformant Algorithms</span><a class=self-link href=#conformant-algorithms></a></h3>

    <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>

    <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>

<h3 class="no-ref no-num heading settled" id=conformance-classes><span class=content>Conformance Classes</span><a class=self-link href=#conformance-classes></a></h3>

    <p>A <dfn data-dfn-type=dfn data-noexport="" id=conformant-user-agent>conformant user agent<a class=self-link href=#conformant-user-agent></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>

    <p>A <dfn data-dfn-type=dfn data-noexport="" id=conformant-server>conformant server<a class=self-link href=#conformant-server></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>



<h2 class="no-num heading settled" id=references><span class=content>References</span><a class=self-link href=#references></a></h2><h3 class="no-num heading settled" id=normative><span class=content>Normative References</span><a class=self-link href=#normative></a></h3><dl><dt id=biblio-cab title=CAB><a class=self-link href=#biblio-cab></a>[CAB]<dd>???. <a href=https://cabforum.org/baseline-requirements-documents/>CA/Browser Forum Baseline Requirements v1.1.8</a>. URL: <a href=https://cabforum.org/baseline-requirements-documents/>https://cabforum.org/baseline-requirements-documents/</a><dt id=biblio-fetch title=FETCH><a class=self-link href=#biblio-fetch></a>[FETCH]<dd>Anne van Kesteren. <a href=https://fetch.spec.whatwg.org/>Fetch</a>. Living Standard. URL: <a href=https://fetch.spec.whatwg.org/>https://fetch.spec.whatwg.org/</a><dt id=biblio-rfc6454 title=RFC6454><a class=self-link href=#biblio-rfc6454></a>[RFC6454]<dd>Adam Barth. <a href=http://www.ietf.org/rfc/rfc6454.txt>The Web Origin Concept</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6454.txt>http://www.ietf.org/rfc/rfc6454.txt</a><dt id=biblio-rfc6455 title=RFC6455><a class=self-link href=#biblio-rfc6455></a>[RFC6455]<dd>Ian Fette; Alexey Melnikov. <a href=http://www.ietf.org/rfc/rfc6455.txt>The WebSocket Protocol</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6455.txt>http://www.ietf.org/rfc/rfc6455.txt</a><dt id=biblio-html5 title=html5><a class=self-link href=#biblio-html5></a>[html5]<dd>Robin Berjon; et al. <a href=http://www.w3.org/TR/html5/>HTML5</a>. 28 October 2014. REC. URL: <a href=http://www.w3.org/TR/html5/>http://www.w3.org/TR/html5/</a><dt id=biblio-rfc2119 title=rfc2119><a class=self-link href=#biblio-rfc2119></a>[rfc2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a><dt id=biblio-websockets title=websockets><a class=self-link href=#biblio-websockets></a>[websockets]<dd>Ian Hickson. <a href=http://www.w3.org/TR/websockets/>The WebSocket API</a>. 20 September 2012. CR. URL: <a href=http://www.w3.org/TR/websockets/>http://www.w3.org/TR/websockets/</a></dl><h3 class="no-num heading settled" id=informative><span class=content>Informative References</span><a class=self-link href=#informative></a></h3><dl><dt id=biblio-csp title=CSP><a class=self-link href=#biblio-csp></a>[CSP]<dd>Brandon Sterne; Adam Barth. <a href=http://www.w3.org/TR/CSP/>Content Security Policy 1.0</a>. 15 November 2012. CR. URL: <a href=http://www.w3.org/TR/CSP/>http://www.w3.org/TR/CSP/</a><dt id=biblio-rfc6797 title=RFC6797><a class=self-link href=#biblio-rfc6797></a>[RFC6797]<dd>Jeff Hodges; Collin Jackson; Adam Barth. <a href=http://www.ietf.org/rfc/rfc6797.txt>HTTP Strict Transport Security (HSTS)</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6797.txt>http://www.ietf.org/rfc/rfc6797.txt</a><dt id=biblio-uri title=URI><a class=self-link href=#biblio-uri></a>[URI]<dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href=http://www.ietf.org/rfc/rfc3986.txt>Uniform Resource Identifiers (URI): generic syntax</a>. January 2005. URL: <a href=http://www.ietf.org/rfc/rfc3986.txt>http://www.ietf.org/rfc/rfc3986.txt</a><dt id=biblio-rfc6919 title=rfc6919><a class=self-link href=#biblio-rfc6919></a>[rfc6919]<dd>R. Barnes; S. Kent; E. Rescorla. <a href=http://www.ietf.org/rfc/rfc6919.txt>Further Key Words for Use in RFCs to Indicate Requirement Levels</a>. 1 April 2013. Experimental. URL: <a href=http://www.ietf.org/rfc/rfc6919.txt>http://www.ietf.org/rfc/rfc6919.txt</a><dt id=biblio-wsc-ui title=wsc-ui><a class=self-link href=#biblio-wsc-ui></a>[wsc-ui]<dd>Thomas Roessler; Anil Saldhana. <a href=http://www.w3.org/TR/wsc-ui/>Web Security Context: User Interface Guidelines</a>. 12 August 2010. REC. URL: <a href=http://www.w3.org/TR/wsc-ui/>http://www.w3.org/TR/wsc-ui/</a></dl><h2 class="no-num heading settled" id=index><span class=content>Index</span><a class=self-link href=#index></a></h2><ul class=indexlist><li>a priori insecure, <a href=#a-priori-insecure-origin title="section 2.1">2.1</a><li>a priori insecure origin, <a href=#a-priori-insecure-origin title="section 2.1">2.1</a><li>a priori insecure URL, <a href=#a-priori-insecure-url title="section 2.1">2.1</a><li>blockable, <a href=#blockable-content title="section 3.2">3.2</a><li>blockable content, <a href=#blockable-content title="section 3.2">3.2</a><li>blockable request context, <a href=#blockable-request-context title="section 3.2">3.2</a><li>client, <a href=#request-client title="section 2.2">2.2</a><li>conformant server, <a href=#conformant-server title="section Unnumbered section">Unnumbered section</a><li>conformant user agent, <a href=#conformant-user-agent title="section Unnumbered section">Unnumbered section</a><li>context, <a href=#request-context title="section 2.2">2.2</a><li>deprecated, <a href=#deprecated-tls-protection title="section 2.1">2.1</a><li>deprecated TLS-protection, <a href=#deprecated-tls-protection title="section 2.1">2.1</a><li>embedding document, <a href=#embedding-document title="section 2.2">2.2</a><li>environment settings object, <a href=#environment-settings-object title="section 2.2">2.2</a><li>fetch, <a href=#fetch title="section 2.2">2.2</a><li>frame type, <a href=#request-context-frame-type title="section 2.2">2.2</a><li>globally unique identifier, <a href=#globally-unique-identifier title="section 2.2">2.2</a><li>insecure, <a href=#insecure-origin title="section 2.1">2.1</a><li>insecure origin, <a href=#insecure-origin title="section 2.1">2.1</a><li>insecure URL, <a href=#insecure-url title="section 2.1">2.1</a><li>mixed, <a href=#mixed-content title="section 2.1">2.1</a><li>mixed content, <a href=#mixed-content title="section 2.1">2.1</a><li>network error, <a href=#network-error title="section 2.2">2.2</a><li>optionally-blockable, <a href=#optionally-blockable-content title="section 3.1">3.1</a><li>optionally-blockable content, <a href=#optionally-blockable-content title="section 3.1">3.1</a><li>optionally-blockable request
    contexts, <a href=#optionally-blockable-request-contexts title="section 3.1">3.1</a><li>origin, <a href=#origin title="section 2.2">2.2</a><li>potentially secure, <a href=#potentially-secure-origin title="section 2.1">2.1</a><li>potentially secure origin, <a href=#potentially-secure-origin title="section 2.1">2.1</a><li>potentially secure URL, <a href=#potentially-secure-url title="section 2.1">2.1</a><li>request, <a href=#request title="section 2.2">2.2</a><li>request client, <a href=#request-client title="section 2.2">2.2</a><li>request client TLS state, <a href=#request-client-tls-state title="section 2.2">2.2</a><li>request context, <a href=#request-context title="section 2.2">2.2</a><li>request context frame type, <a href=#request-context-frame-type title="section 2.2">2.2</a><li>response, <a href=#response title="section 2.2">2.2</a><li>response TLS state, <a href=#response-tls-state title="section 2.2">2.2</a><li>strictMixedContentChecking, <a href=#dom-htmliframeelement-strictmixedcontentchecking title="section 4.3">4.3</a><li>strict-mixed-content-checking, <a href=#element-attrdef-iframe-strict-mixed-content-checking title="section 4.2">4.2</a><li>strict-mixed-content-checking-directive, <a href=#strict-mixed-content-checking-directive title="section 4.1">4.1</a><li>strict mixed content checking flag, <a href=#strict-mixed-content-checking-flag title="section 4">4</a><li>tls state, <a href=#request-client-tls-state title="section 2.2">2.2</a></ul><h2 class="no-num heading settled" id=idl-index><span class=content>IDL Index</span><a class=self-link href=#idl-index></a></h2><pre class=idl>partial interface <a class=idl-code data-global-name="" data-link-type=interface href=https://html.spec.whatwg.org/#htmliframeelement>HTMLIFrameElement</a> {
  readonly attribute boolean <a class=idl-code data-global-name="HTMLIFrameElement<interface>/strictmixedcontentchecking<attribute>" data-link-for=HTMLIFrameElement data-link-type=attribute data-readonly="" data-type="boolean " href=#dom-htmliframeelement-strictmixedcontentchecking>strictMixedContentChecking</a>;
};

</pre>